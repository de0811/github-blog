---
aliases:
  - 보안 설정
  - SpringBootWebSecurityConfiguration
  - HttpSecurity
tags:
  - Spring
  - Spring/Security
특징: 
---
# 보안 설정
HttpSecurity 설정하거나 비밀번호 암호화 방법 또는 기타 보안에 관련된 설정을 진행

초기 아이디와 비밀번호가 바뀌는 것을 강제로 고정할 수 있는 방법
```properties title:"기본 Security 계정 설정"
spring.security.user.name=qwe  
spring.security.user.password=1234
```
## SpringBootWebSecurityConfiguration
`defaultSecurityFilterChain` 함수는 `SecurityFilterChain` 설정을 하지 않으면 기본적으로 설정하는 함수
```java title:"defaultSecurityFilterChain()"
@Bean  
@Order(SecurityProperties.BASIC_AUTH_ORDER)  
SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {  
  http.authorizeHttpRequests((requests) -> requests.anyRequest().authenticated());  
  http.formLogin(withDefaults());  // 웹폼 통해서 로그인 수행 매커니즘, CSRF 공격 방지를 위한 보호기능 포함
  http.httpBasic(withDefaults());  // username, password Base64 인코딩 하여 HTTP 헤더에 포함(암호화 되지 않아 취약)
  return http.build();  
}
```
Spring Security 를 이용하기 위해서는 `SecurityFilterChain` `bean` 필수로 등록 해야함
## Method Level Security 
[[2.Ref(데이터 및 정보 저장)/Spring/Annotation/@ EnableMethodSecurity|@EnableMethodSecurity]] 설정으로 활성화 가능
## AUTHENTICATION(인증) & AUTHORIZATION(권한)
인증, 권한, 역할, 특권 기반의 액세스 매커니즘
요청을 인증(자격 증명) -> 권한 확인

인증은 접근하려는 유저의 식별하는 것
권한은 인증된 후 어떠한 권한을 가지고 할 수 있는지에 대해 확인 하기 위해 필요
인증 실패 401 에러
권한 에러 403 에러
```java
@Configuration  
public class SecurityConfig {  
  @Bean  
  SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {  
        http.authorizeHttpRequests(authorizeRequests ->  
      authorizeRequests.requestMatchers("/myAccount", "/myBalance").authenticated()  
//        .requestMatchers("/myCards").hasAnyAuthority("ROLE_ADMIN")  
        .requestMatchers("/myLoans").hasAnyRole("ADMIN")  
        .requestMatchers("/notices", "/contact", "/register").permitAll()  
    );
  }
}
```
> 권한 설정의 예

```java title:"권한 설정 함수"
authenticated() ; //인증된 사용자의 접근을 허용  
fullyAuthenticated(): //인증된 사용자의 접근을 허용, rememberMe인증 제외  
permitAll(): //무조건 허용  
denyAll(): //무조건 차단  
anonymous(): //익명사용자 허용  
rememberMe(): //rememberMe 인증 사용자 접근 허용  
access(String): //주어진 SpEL표현식의 평가 결과가 true 이면 접근허용  
hasRole(String): //사용자가 주어진 역할이 있다면 접근을 허용 "ADMIN" 값만 입력해야함 "ROLE_" 부분 생략
hasAuthority(String): //사용자가 주어진 권한이 있다면 허용
hasAnyRole(String...): //사용자가 주어진 어떤권한이라도 있으면 허용 "ADMIN" 값만 입력해야함 "ROLE_" 부분 생략
hasAnyAuthority(String...): //사용자가 주어진 권한중 어떤 것이라도 있다면 허용  
hasIpAddress(String): //주어진 IP로 부터 요청이 왔다면 접근을 허용
```
> 권한 설정 함수

## ![[2.Ref(데이터 및 정보 저장)/Spring/Security/CORS|CORS]]
## ![[2.Ref(데이터 및 정보 저장)/Spring/Security/CSRF|CSRF]] 
## Spring Security 옵션 별 필터

```java
http.formLogin(AbstractHttpConfigurer::disable);
//    http.formLogin(AbstractHttpConfigurer::disable);
```
> UsernamePasswordAuthenticationFilter, DefaultLoginPageGeneratingFilter, DefaultLogoutPageGeneratingFilter

```java title:"HTTP Basic 인증"
http.httpBasic(Customizer.withDefaults());
//    http.httpBasic(Customizer.withDefaults());
```
> BasicAuthenticationFilter

```java
http.sessionManagement(sessionManagement -> sessionManagement.sessionCreationPolicy(SessionCreationPolicy.????))
```
> SessionManagementFilter

```java
http.sessionManagement(sessionManagement -> sessionManagement.sessionCreationPolicy(SessionCreationPolicy.ALWAYS))
```
> SessionManagementFilter, ForceEagerSessionCreationFilter

```java
http.csrf(AbstractHttpConfigurer::disable);
```
> CsrfFilter

```java
//    http.cors(cors -> cors.configurationSource(request -> corsConfiguration()));  
    http.cors(AbstractHttpConfigurer::disable);
```
> CorsFilter

```java
http.logout(AbstractHttpConfigurer::disable);
```
> LogoutFilter, DefaultLogoutPageGeneratingFilter

```java
http.oauth2Login(Customizer.withDefaults());
```
> OAuth2AuthorizationRequestRedirectFilter, OAuth2LoginAuthenticationFilter

```java
http.oauth2Login(oauth2LoginCustomizer -> oauth2LoginCustomizer.userInfoEndpoint(userInfoEndpoint -> userInfoEndpoint.userService(principalOauth2UserService)));
```
> OAuth2AuthorizationRequestRedirectFilter, OAuth2LoginAuthenticationFilter