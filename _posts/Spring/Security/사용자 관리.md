---
aliases:
  - 사용자 관리
  - UserDetailsService
  - UserDetailsManager
  - InMemoryUserDetailsManager
  - JdbcUserDetailsManager
  - LdapUserDetailsManager
tags:
  - Spring
  - Spring/Security
특징: 사용자 데이터를 관리(생성,삭제,수정,조회)
---
# 사용자 관리
## UserDetailsService, UserDetailsManager
`UserDetailsService` 는 `loadUserByUsername(username)` 으로 `username` 으로 사용자 정보를 반환하는 인터페이스
`username` 정보만 전달하는 이유는 DB로 전달한다고 생각해보면 중간에 `password`가 유출될 가능성이 있기 때문에 전달하지 않음
`UserDetailsManager` 는 각종 생성 삭제 등등의 기능을 제공하는 인터페이스
```java title:"UserDetailsManager"
void createUser(UserDetails user);  
void updateUser(UserDetails user);  
void deleteUser(String username);  
void changePassword(String oldPassword, String newPassword);  
boolean userExists(String username);
```
`UserDetailsManager`를 사용하기에는 생성과 삭제 갱신등에서 굳이 `Spring Security`가 연결될 필요는 없기 때문에 보통 `UserDetailsManager`를 사용하지 않음
`InMemoryUserDetailsManager` 이나 `JdbcUserDetailsManager` 등 모두 그저 테스트 정도로 쓸 수 있는 것이지 실제 프로젝트에서 사용하기엔 문제가 있음
### InMemoryUserDetailsManager
`Memory` 에 `UserDetails` 담아놓는 클래스
### JdbcUserDetailsManager
```sql
create table users(  
                      id bigint not null primary key auto_increment,  
                      username varchar_ignorecase(50) not null unique,  
                      password varchar_ignorecase(500) not null,  
                      enabled boolean not null  
);  
  
create table authorities (  
                            id bigint not null primary key auto_increment,  
                             username varchar_ignorecase(50) not null,  
                             authority varchar_ignorecase(50) not null,  
                             constraint fk_authorities_users foreign key(username) references users(username)  
);  
create unique index ix_auth_username on authorities (username,authority);
```

기본적으로 이런 스키마를 사용
https://docs.spring.io/spring-security/reference/servlet/authentication/passwords/jdbc.html
공홈에 각 DB 마다 사용하는 내용이 정리되어 있음
### LdapUserDetailsManager
