1:"$Sreact.fragment"
2:I[4615,["874","static/chunks/874-ac0c32a4a9a6131e.js","177","static/chunks/app/layout-aa9facf8c991085d.js"],"default"]
3:I[7555,[],""]
4:I[1295,[],""]
6:I[9665,[],"MetadataBoundary"]
8:I[9665,[],"OutletBoundary"]
b:I[4911,[],"AsyncMetadataOutlet"]
d:I[9665,[],"ViewportBoundary"]
f:I[6614,[],""]
:HL["/github-blog/_next/static/css/f13864532fe49912.css","style"]
:HL["/github-blog/_next/static/css/9977e1cbb75c82aa.css","style"]
0:{"P":null,"b":"PsahSZRVuFaRsqDSv3j8u","p":"/github-blog","c":["","blog","f499cc48",""],"i":false,"f":[[["",{"children":["blog",{"children":[["slugHash","f499cc48","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/github-blog/_next/static/css/f13864532fe49912.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"kr","children":["$","body",null,{"children":[["$","$L2",null,{}],["$","main",null,{"children":["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slugHash","f499cc48","d"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L5",["$","$L6",null,{"children":"$L7"}],[["$","link","0",{"rel":"stylesheet","href":"/github-blog/_next/static/css/9977e1cbb75c82aa.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L8",null,{"children":["$L9","$La",["$","$Lb",null,{"promise":"$@c"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","5pOnqtWeWLRCpHbqEvvR5",{"children":[["$","$Ld",null,{"children":"$Le"}],null]}],null]}],false]],"m":"$undefined","G":["$f","$undefined"],"s":false,"S":true}
10:"$Sreact.suspense"
11:I[4911,[],"AsyncMetadata"]
7:["$","$10",null,{"fallback":null,"children":["$","$L11",null,{"promise":"$@12"}]}]
a:null
13:I[733,["63","static/chunks/63-df0ec183627b3631.js","727","static/chunks/727-6368b5a9647a1769.js","401","static/chunks/app/blog/%5BslugHash%5D/page-ae6b75d4d7185f4d.js"],"default"]
14:T2b415,<h1 style="color: #82AAFF;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h1</span>
                  Proxy
                </h1>
<p>Proxy(대리인)</p>
<p>초기화 지연, 접근 제어, 로깅, 캐싱 등, 기존 대상 원본 객체를 수정 없이 추가 동작 기능들을 가미하고 싶을 때 사용하는 코드 패턴</p>
<p><strong><code>RealSubject</code>는 자신의 기능에만 집중을 하고</strong> 그 이외 <strong>부가 기능을 제공하거나 접근을 제어하는 역할을 <code>Proxy</code> 객체에게 위임</strong><br>이로 인해 <code>SOLID</code>원칙 중 <code>OCP</code>와 를 지향하는 코드로 작성이 가능<br>를 지향하는 코드로 작성이 가능
<img src="/github-blog/images/AttachedFile/SRP.png" alt="SRP.png" style="width:800px"></p>
<p>Wrapper 기능과 같은게 아닌가 생각 듬 (똑같은 이름으로 기능만 추가하는 방식)<br> 기능을 만들때 사용 될 듯<br>하지만 단점은 역시 <a href="/github-blog/blog/ee2323b8">AOP</a> 기능을 만들때 사용 될 듯
하지만 단점은 역시 <code>interface</code> 가 필요하고 상속 받아 대상을 실행하면서 추가적인 기능을 넣어야하기 때문에 소스가 굉장히 많아지기 때문에 소스가 지저분함</p>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  주요 기능
                </h2>
<ul>
<li>접근 제어
<ul>
<li>권한에 따른 접근 차단</li>
<li>캐싱</li>
<li>지연 로딩</li>
</ul>
</li>
<li>부가 기능 추가
<ul>
<li>원래 서버가 제공하는 기능에 더해서 부가 기능을 수행
<ul>
<li>요청 값이나 응답 값을 중간에 변형</li>
<li>실행 시간을 측정</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  장점
                </h2>
<ul>
<li>기존 객체를 수정하지 않고 일련의 로직을 프록시 패턴을 통해 추가</li>
<li>실제 객체를 수행하기 이전에 전처리를 하거나, 기존 객체를 캐싱할 수 있음</li>
</ul>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  단점
                </h2>
<ul>
<li>객체 생성시 한단계 거치게 됨으로 빈번한 객체 생성이 필요해서 성능 저하(and 귀찮음)</li>
<li>계층이 추가되어 코드의 복잡도 증가 (로직이 너무 난해하고 복잡해짐)</li>
</ul>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  예제
                </h2>
<p>Interface Proxy 와 Class Proxy 차이</p>
<ul>
<li>클래스 프록시는 해당 클래스에만 적용 가능 / 인터페이스 프록시는 인터페이스만 같으면 모든 곳에 적용 가능</li>
<li>클래스 프록시는 상속을 사용하기 때문에 몇가지 제약 발생
<ul>
<li>부모 클래스의 생성자를 호출 필요</li>
<li>클래스에 final 키워드가 붙으면 상속 불가</li>
<li>메서드에 final 키워드가 붙으면 <a href="/github-blog/blog/d0192ff4">오버라이딩 (overriding)</a> 불가</li>
</ul>
</li>
<li>인터페이스 프록시는 캐스팅 단점</li>
</ul>
<h3 style="color: #C792EA;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h3</span>
                  Interface Proxy
                </h3>
<p><img src="/github-blog/images/AttachedFile/proxy-sample.png" alt="proxy-sample.png" style=""></p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">Proxy 사용하여 A 로직 시간 측정</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">AInterface</span> {</span><span class="line">    String <span class="hljs-title function_">call</span><span class="hljs-params">()</span>;</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AInterface</span> {</span><span class="line">    <span class="hljs-meta">@Override</span></span><span class="line">    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> {</span><span class="line">        System.out.println(<span class="hljs-string">&quot;A 호출&quot;</span>);</span><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;a&quot;</span>;</span><span class="line">    }</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AInterface</span> {</span><span class="line">    AInterface subject;</span><span class="line">&nbsp;</span><span class="line">    AProxy(AInterface subject) {</span><span class="line">        <span class="hljs-built_in">this</span>.subject = subject;</span><span class="line">    }</span><span class="line">&nbsp;</span><span class="line">    <span class="hljs-meta">@Override</span></span><span class="line">    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> {</span><span class="line">        System.out.println(<span class="hljs-string">&quot;TimeProxy 실행&quot;</span>);</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> subject.call();</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">resultTime</span> <span class="hljs-operator">=</span> endTime - startTime;</span><span class="line">        System.out.println(<span class="hljs-string">&quot;TimeProxy 종료 resultTime = &quot;</span> + resultTime);</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-keyword">return</span> result;</span><span class="line">    }</span><span class="line">}</span></code></pre>
        </div>
      

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">Proxy 사용하여 B 로직 시간 측정</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">BInterface</span> {</span><span class="line">    String <span class="hljs-title function_">call</span><span class="hljs-params">()</span>;</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BInterface</span> {</span><span class="line">    <span class="hljs-meta">@Override</span></span><span class="line">    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> {</span><span class="line">        System.out.println(<span class="hljs-string">&quot;B 호출&quot;</span>);</span><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;b&quot;</span>;</span><span class="line">    }</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BInterface</span> {</span><span class="line">    BInterface subject;</span><span class="line">&nbsp;</span><span class="line">    BProxy(BInterface subject) {</span><span class="line">        <span class="hljs-built_in">this</span>.subject = subject;</span><span class="line">    }</span><span class="line">&nbsp;</span><span class="line">    <span class="hljs-meta">@Override</span></span><span class="line">    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> {</span><span class="line">        System.out.println(<span class="hljs-string">&quot;TimeProxy 실행&quot;</span>);</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> subject.call();</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">resultTime</span> <span class="hljs-operator">=</span> endTime - startTime;</span><span class="line">        System.out.println(<span class="hljs-string">&quot;TimeProxy 종료 resultTime = &quot;</span> + resultTime);</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-keyword">return</span> result;</span><span class="line">    }</span><span class="line">}</span></code></pre>
        </div>
      

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">똑같은 로직인데 그냥 같은 인터페이스 썻어도 되지 않나 싶지만 어쨋든 불필요한 소스가 낭비된다는걸 보여주는거니까</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> {</span><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {</span><span class="line">        <span class="hljs-type">AInterface</span> <span class="hljs-variable">proxyA</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AProxy</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AImpl</span>());</span><span class="line">        proxyA.call();</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-type">BInterface</span> <span class="hljs-variable">proxyB</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BProxy</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BImpl</span>());</span><span class="line">        proxyB.call();</span><span class="line">    }</span><span class="line">}</span></code></pre>
        </div>
      
<p>해당 예제에서 알 수 있듯이 Proxy 클래스를 만드느라 불필요한 소스가 굉장히 많이 낭비되고 소스 읽기도 힘듬</p>
<h3 style="color: #C792EA;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h3</span>
                  Class Proxy
                </h3>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">인터페이스를 사용하지 않은 프록시</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-meta">@Slf4j</span>  </span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteLogic</span> {  <span class="hljs-comment">// target Logic</span></span><span class="line">  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">operation</span><span class="hljs-params">()</span> {  </span><span class="line">    log.info(<span class="hljs-string">&quot;ConcreteLogic.operation()&quot;</span>);  </span><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ConcreteLogic Data&quot;</span>;  </span><span class="line">  }  </span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-meta">@Slf4j</span>  </span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeProxy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ConcreteLogic</span> {  <span class="hljs-comment">// Proxy</span></span><span class="line">  <span class="hljs-keyword">private</span> ConcreteLogic concreteLogic;  </span><span class="line">  </span><span class="line">  <span class="hljs-keyword">public</span> <span class="hljs-title function_">TimeProxy</span><span class="hljs-params">(ConcreteLogic concreteLogic)</span> {  </span><span class="line">    <span class="hljs-built_in">this</span>.concreteLogic = concreteLogic;  </span><span class="line">  }  </span><span class="line">  </span><span class="line">  <span class="hljs-meta">@Override</span>  </span><span class="line">  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">operation</span><span class="hljs-params">()</span> {  </span><span class="line">    log.info(<span class="hljs-string">&quot;TimeProxy.operation()&quot;</span>);  </span><span class="line">    <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();  </span><span class="line">    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> concreteLogic.operation();  </span><span class="line">    <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();  </span><span class="line">    log.info(<span class="hljs-string">&quot;Time: &quot;</span> + (end - start));  </span><span class="line">    <span class="hljs-keyword">return</span> result;  </span><span class="line">  }  </span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteClient</span> {  </span><span class="line">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcreteLogic concreteLogic;  </span><span class="line">  </span><span class="line">  <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcreteClient</span><span class="hljs-params">(ConcreteLogic concreteLogic)</span> {  </span><span class="line">    <span class="hljs-built_in">this</span>.concreteLogic = concreteLogic;  </span><span class="line">  }  </span><span class="line">  </span><span class="line">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {  </span><span class="line">    concreteLogic.operation();  </span><span class="line">  }</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-meta">@Test</span>  </span><span class="line"><span class="hljs-keyword">void</span> <span class="hljs-title function_">addProxy</span><span class="hljs-params">()</span> {  <span class="hljs-comment">//실행</span></span><span class="line">  <span class="hljs-type">ConcreteLogic</span> <span class="hljs-variable">concreteLogic</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteLogic</span>();  </span><span class="line">  <span class="hljs-type">TimeProxy</span> <span class="hljs-variable">timeProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TimeProxy</span>(concreteLogic);  </span><span class="line">  <span class="hljs-type">ConcreteClient</span> <span class="hljs-variable">concreteClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteClient</span>(timeProxy);  </span><span class="line">  concreteClient.execute();  </span><span class="line">}</span></code></pre>
        </div>
      
<h1 style="color: #82AAFF;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h1</span>
                  Dynamic Proxy
                </h1>
<p>Proxy 의 단점을 보안하기 위해 컴파일 시점이 아닌 런타임 시점에 프록시를 만들어주는 방식을 동적 프록시 라고 함<br>java 에서 제공하는 <a href="/github-blog/blog/e82275c0">Reflection</a> 기능을 사용</p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">java</span>.io.Serializable {</span><span class="line"><span class="hljs-meta">@CallerSensitive</span>  </span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">newProxyInstance</span><span class="hljs-params">(ClassLoader loader,  // 클래스 로더</span><span class="line">                                      Class&lt;?&gt;[] interfaces, // 타겟의 인터페이스</span><span class="line">                                      InvocationHandler h)</span> {...} <span class="hljs-comment">// 타깃의 정보가 포함된 Handler</span></span><span class="line">}</span></code></pre>
        </div>
      
<ul>
<li><code>ClassLoader loader</code>
<ul>
<li>프록시 클래스를 만들 클래스 로더(Class Loader)</li>
<li>Proxy 객체가 구현할 Interface에 Class Loader 를 얻어오는 것이 일반적</li>
</ul>
</li>
<li><code>Class&#x3C;?>[] interfaces</code>
<ul>
<li>프록시 클래스가 구현하고자 하는 인터페이스 목록(배열)</li>
<li>메서드를 통해 생성 될 Proxy 객체가 구현할 Interface를 정의</li>
</ul>
</li>
<li><code>InvocationHandler h</code>
<ul>
<li>프록시의 메서드(invoke)가 호출되었을때 실행되는 핸들러 메서드</li>
</ul>
</li>
</ul>
<p><code>invoke()</code> 메서드는 동적 프록시의 메서드가 호출되었을때, 이를 낚아채어 대신 실행되는 메서드<br>메서드 <a href="/github-blog/blog/a1afe82a">파라메터</a> 를 통해 어떤 메서드가 실행되었는지 메서드 정보와 메서드에 전달된 인자까지 알 수 있음</p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InvocationHandler</span> {</span><span class="line">    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span></span><span class="line">        <span class="hljs-keyword">throws</span> Throwable;</span><span class="line">}</span></code></pre>
        </div>
      
<ul>
<li><code>Object proxy</code> : 프록시 객체</li>
<li><code>Method method</code> : 호출한 메서드 정보</li>
<li><code>Object[] args</code> : 메서드에 전달된 매개변수 (배열)</li>
</ul>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  단점
                </h2>
<ul>
<li>타입을 무조건 <code>interface</code> 로 넣어줘야함
<ul>
<li>해당 방법을 해결하기 위해 CGLIB 를 이용해서 바이트코드를 조작해서 동적 프록시 기술을 응용하는 라이브러리로 해결할 수 있음</li>
<li>스프링에서는 인터페이스가 있을 경우 JDK Dynamic Proxy 를 사용하며 클래스의 경우 <a href="#"></a>를 사용</li>
</ul>
</li>
</ul>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  예제
                </h2>
<p><img src="/github-blog/images/AttachedFile/dynamic-proxy.png" alt="dynamic-proxy.png" style=""></p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;</span><span class="line"><span class="hljs-keyword">import</span> java.lang.reflect.Method;</span><span class="line"><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-comment">// InvocationHandler 프록시 메서드 핸들러를 클래스 필드 변수를 이용해야 하기 때문에 재정의 함</span></span><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProxyHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {</span><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object target;</span><span class="line">&nbsp;</span><span class="line">    MyProxyHandler(Object target) {</span><span class="line">        <span class="hljs-built_in">this</span>.target = target;</span><span class="line">    }</span><span class="line">&nbsp;</span><span class="line">    <span class="hljs-meta">@Override</span></span><span class="line">    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {</span><span class="line">        System.out.println(<span class="hljs-string">&quot;TimeProxy 실행&quot;</span>);</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args); <span class="hljs-comment">// 파라미터로 전달받은 메서드를 invoke로 실행</span></span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">resultTime</span> <span class="hljs-operator">=</span> endTime - startTime;</span><span class="line">        System.out.println(<span class="hljs-string">&quot;TimeProxy 종료 resultTime = &quot;</span> + resultTime);</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-keyword">return</span> result;</span><span class="line">    }</span><span class="line">}</span></code></pre>
        </div>
      

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> {</span><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {</span><span class="line">    </span><span class="line">        <span class="hljs-type">AInterface</span> <span class="hljs-variable">proxyA</span> <span class="hljs-operator">=</span> (AInterface) Proxy.newProxyInstance(</span><span class="line">                AInterface.class.getClassLoader(),</span><span class="line">                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]{AInterface.class},</span><span class="line">                <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyProxyHandler</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AImpl</span>())</span><span class="line">        );</span><span class="line">        proxyA.call();</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-type">BInterface</span> <span class="hljs-variable">proxyB</span> <span class="hljs-operator">=</span> (BInterface) Proxy.newProxyInstance(</span><span class="line">                BInterface.class.getClassLoader(),</span><span class="line">                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]{BInterface.class},</span><span class="line">                <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyProxyHandler</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BImpl</span>())</span><span class="line">        );</span><span class="line">        proxyB.call();</span><span class="line">    }</span><span class="line">}</span></code></pre>
        </div>
      
<h3 style="color: #C792EA;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h3</span>
                  메서드 필터링 예제
                </h3>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">AInterface</span> {</span><span class="line">    String <span class="hljs-title function_">call</span><span class="hljs-params">()</span>;</span><span class="line">    <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span>;</span><span class="line">    <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span>;</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AInterface</span> {</span><span class="line">    <span class="hljs-meta">@Override</span></span><span class="line">    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> {</span><span class="line">        System.out.println(<span class="hljs-string">&quot;A 호출&quot;</span>);</span><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;a&quot;</span>;</span><span class="line">    }</span><span class="line">&nbsp;</span><span class="line">    <span class="hljs-meta">@Override</span></span><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> {</span><span class="line">        System.out.println(<span class="hljs-string">&quot;A print @@@@@@@&quot;</span>);</span><span class="line">    }</span><span class="line">&nbsp;</span><span class="line">    <span class="hljs-meta">@Override</span></span><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {</span><span class="line">        System.out.println(<span class="hljs-string">&quot;A Running !!!!!!!!!&quot;</span>);</span><span class="line">    }</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> {</span><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] arguments)</span> {</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-type">AInterface</span> <span class="hljs-variable">proxyA</span> <span class="hljs-operator">=</span> (AInterface) Proxy.newProxyInstance(</span><span class="line">                AInterface.class.getClassLoader(),</span><span class="line">                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]{AInterface.class},</span><span class="line">                (proxy, method, args) -&gt; {</span><span class="line">                    <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AImpl</span>();</span><span class="line">&nbsp;</span><span class="line">                    <span class="hljs-comment">// 실행한 메서드가 call 일 경우 로깅 기능을 가미하여 리턴</span></span><span class="line">                    <span class="hljs-keyword">if</span>(method.getName().equals(<span class="hljs-string">&quot;call&quot;</span>)) {</span><span class="line">                        System.out.println(<span class="hljs-string">&quot;TimeProxy 실행&quot;</span>);</span><span class="line">                        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">&nbsp;</span><span class="line">                        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args); <span class="hljs-comment">// 파라미터로 전달받은 메서드를 invoke로 실행</span></span><span class="line">&nbsp;</span><span class="line">                        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">                        <span class="hljs-type">long</span> <span class="hljs-variable">resultTime</span> <span class="hljs-operator">=</span> endTime - startTime;</span><span class="line">                        System.out.println(<span class="hljs-string">&quot;TimeProxy 종료 resultTime = &quot;</span> + resultTime);</span><span class="line">&nbsp;</span><span class="line">                        <span class="hljs-keyword">return</span> result;</span><span class="line">                    }</span><span class="line">&nbsp;</span><span class="line">                    <span class="hljs-comment">// 만일 메서드가 run이나 print 일경우 로깅 기능을 가미하지않고 그냥 그대로 원본 대상 객체의 메서드를 실행하고 리턴하도록 지정</span></span><span class="line">                    <span class="hljs-keyword">return</span> method.invoke(target, args);</span><span class="line">                }</span><span class="line">        );</span><span class="line">&nbsp;</span><span class="line">        proxyA.call();</span><span class="line">        proxyA.print();</span><span class="line">        proxyA.run();</span><span class="line">    }</span><span class="line">}</span></code></pre>
        </div>
      
<blockquote>
<p>람다 방식으로 작성</p>
</blockquote>
<h1 style="color: #82AAFF;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h1</span>
                  CGLIB 라이브러리
                </h1>
<p><a href="#"></a>의 단점을 해결할 수 있는 라이브러리<br><code>JDK</code>의 <code>Dynamic Proxy</code> 와는 다르게 인터페이스가 아닌 클래스를 대상으로 를 조작해 프록시 생성할 수 있는 라이브러리<br>오히려 를 조작해 프록시 생성할 수 있는 라이브러리
오히려 <code>Dynamic Proxy</code> 비해서 성능이 좋으며 그 효과로 인해 스프링 프레임워크에 기본으로 내장</p>
<p>스프링 프로젝트가 아닌 일반 자바 프로젝트의 경우 외부 라이브러리 다운 &#x26; 적용이 필요<br><a href="https://github.com/cglib/cglib/releases/tag/RELEASE_3_3_0">CGLIB 다운로드</a> 다른 버전은 알아서 찾아</p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">import</span> net.sf.cglib.proxy.*; <span class="hljs-comment">// cglib 임포트 (다운 받아서 사용할때)</span></span><span class="line"><span class="hljs-keyword">import</span> org.springframework.cglib.proxy.*;  <span class="hljs-comment">// cglib 임포트 (Spring 내부에서 사용할 때)</span></span></code></pre>
        </div>
      
<blockquote>
<p>import 위치</p>
</blockquote>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(</span><span class="line">	Object o,                    // CGLIB가 적용된 객체</span><span class="line">	Method method,               // 호출된 메서드</span><span class="line">	Object[] args,               // 메서드를 호출하면서 전달된 인수</span><span class="line">	MethodProxy methodProxy      // 메서드 호출에 사용</span><span class="line">)</span> <span class="hljs-keyword">throws</span> Throwable {}</span></code></pre>
        </div>
      
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  단점
                </h2>
<ul>
<li>기본적으로 <strong>클래스 상속(extends)를 통해 프록시 구현</strong>이 되기 때문에 타겟 클래스가 상속이 불가능할때는 당연히 프록시 등록이 불가능</li>
<li>메서드에 final 키워드가 붙게 되면 해당 메서드를 오버라이딩하여 사용 할 수 없기 때문에 결과적으로 프록시 메서드 로직이 동작하지 않음</li>
<li>통합적으로 상속에 있어서 제한이 있는 대상은 사용이 불가능</li>
</ul>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  사용이 불가능한 상황
                </h2>
<ul>
<li>추상 클래스(abstract class)</li>
<li>클래스의 생성자를 private 하여 생성자를 제한할 경우</li>
<li>기본 생성자가 없는 경우 사용 불가</li>
<li>생성자 2번 호출 문제
<ul>
<li>실제 target 객체를 생성할 때</li>
<li>프록시 객체를 생성할 때 부모 클래스의 생성자 호출</li>
</ul>
</li>
<li><code>final</code> 키워드 사용하는 클래스 또는 메서드 사용 불가</li>
</ul>
<p><code>final</code> 은 에러는 안뜨는데 아무런 에러 없이 <code>Proxy</code> 동작하지 않음<br>추상클래스(<code>abstract class</code>)와 생성자를 <code>private</code> 경우 컴파일 단계에서 에러가 뜸</p>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  Spring 의 대응한 해결 방법
                </h2>
<ul>
<li>Spring 4.0 이상부터 CGLIB 기본 생상자가 필수인 문제를 해결
<ul>
<li><code>objenesis</code>라는 라이브러리를 이용해서 기본 생성자 없이 객체 생성 가능하도록 추가<br>해당 라이브러리는 생성자 호출 없이 객체를 생성할 수 있게 해줌</li>
</ul>
</li>
<li>생성자 2번 호출 문제
<ul>
<li><code>objenesis</code> 사용으로 생성자 호출 없이 객체 생성으로 생성자 1번만 호출</li>
</ul>
</li>
<li>Spring boot 2.0 이상부터 CGLIB 기본 사용<br>`{properties icon title:"강제로 CGLIB 사용하도록 선택하는 방법(이미 default 값)"}spring.aop.proxy-target-class=true</li>
</ul>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  예제
                </h2>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">모두 풀어서 쓰는 방법 (추천x)</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">import</span> org.springframework.cglib.proxy.*;  </span><span class="line"><span class="hljs-keyword">import</span> java.lang.reflect.Method;</span><span class="line"><span class="hljs-comment">// 프록시 핸들러</span></span><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProxyInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {</span><span class="line">&nbsp;</span><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object target;</span><span class="line">&nbsp;</span><span class="line">    MyProxyInterceptor(Object target) {</span><span class="line">        <span class="hljs-built_in">this</span>.target = target;</span><span class="line">    }</span><span class="line">&nbsp;</span><span class="line">    <span class="hljs-meta">@Override</span></span><span class="line">    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(</span><span class="line">            Object o,</span><span class="line">            Method method,</span><span class="line">            Object[] args,</span><span class="line">            MethodProxy methodProxy</span><span class="line">    )</span> <span class="hljs-keyword">throws</span> Throwable {</span><span class="line">&nbsp;</span><span class="line">        System.out.println(<span class="hljs-string">&quot;TimeProxy 실행&quot;</span>);</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-comment">//Object result = method.invoke(target, args); // 파라미터로 전달받은 메서드를 invoke로 실행</span></span><span class="line">        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> methodProxy.invoke(target, args); <span class="hljs-comment">// MethodProxy 사용하는 것이 속도적으로 조금 더 빠르다함</span></span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">        <span class="hljs-type">long</span> <span class="hljs-variable">resultTime</span> <span class="hljs-operator">=</span> endTime - startTime;</span><span class="line">        System.out.println(<span class="hljs-string">&quot;TimeProxy 종료 resultTime = &quot;</span> + resultTime);</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-keyword">return</span> result;</span><span class="line">    }</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-comment">// 프록시를 적용할 대상 타켓</span></span><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Subject</span> {</span><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> {</span><span class="line">        System.out.println(<span class="hljs-string">&quot;서비스 호출&quot;</span>);</span><span class="line">    }</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> {</span><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] arguments)</span> {</span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-comment">// 1. 프록시 등록 (CGLIB는 Enhancer를 사용해서 프록시를 등록한다)</span></span><span class="line">        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();</span><span class="line">        enhancer.setSuperclass(Subject.class); <span class="hljs-comment">// CGLIB는 구체 클래스를 상속 받아서 프록시를 생성하기 때문에 상혹할 구체 클래스를 지정</span></span><span class="line">        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyProxyInterceptor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>())); <span class="hljs-comment">// 프록시 핸들러 할당</span></span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-comment">// 2. 프록시 생성</span></span><span class="line">        <span class="hljs-type">Subject</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (Subject) enhancer.create(); <span class="hljs-comment">// setSuperclass() 에서 지정한 클래스를 상속 받아서 프록시가 만들어진다.</span></span><span class="line">&nbsp;</span><span class="line">        <span class="hljs-comment">// 3. 프록시 호출</span></span><span class="line">        proxy.call();</span><span class="line">    }</span><span class="line">}</span></code></pre>
        </div>
      

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">간략하게 람다 방식을 사용하는 방법</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> {</span><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] arguments)</span> {</span><span class="line">        </span><span class="line">        <span class="hljs-type">Subject</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (Subject) Enhancer.create(Subject.class, (MethodInterceptor) (o, method, args, methodProxy) -&gt; {</span><span class="line">            <span class="hljs-type">Subject</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>();</span><span class="line">            System.out.println(<span class="hljs-string">&quot;TimeProxy 실행&quot;</span>);</span><span class="line">            <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">            <span class="hljs-comment">// Object result = method.invoke(target, args); // 파라미터로 전달받은 메서드를 invoke로 실행</span></span><span class="line">            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> methodProxy.invoke(target, args); <span class="hljs-comment">// MethodProxy 사용하는 것이 속도적으로 조금 더 빠르다함</span></span><span class="line">            <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.nanoTime();</span><span class="line">            <span class="hljs-type">long</span> <span class="hljs-variable">resultTime</span> <span class="hljs-operator">=</span> endTime - startTime;</span><span class="line">            System.out.println(<span class="hljs-string">&quot;TimeProxy 종료 resultTime = &quot;</span> + resultTime);</span><span class="line">            <span class="hljs-keyword">return</span> result;</span><span class="line">        });</span><span class="line">        </span><span class="line">        proxy.call();</span><span class="line">    }</span><span class="line">}</span></code></pre>
        </div>
      
<blockquote>
<p>람다 방식으로 소스 작성</p>
</blockquote>
<h1 style="color: #82AAFF;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h1</span>
                  ProxyFactory
                </h1>
<p>Spring 지원하는 프록시 방법<br><a href="#"></a>와 <a href="#"></a> 방법을 둘 다 상황에 따라 지원해주는  방법<br> 방법
<a href="#"></a> 클래스와 <a href="#"></a> 에서 사용하는 <code>InvocationHandler</code> 클래스와 [[#CGLIB 라이브러리]] 에서 사용하는 <code>MethodInterceptor</code> 둘 다 지원하기 위한 <code>Advice</code>를 제공</p>
<p><img src="/github-blog/images/AttachedFile/Pasted%20image%2020240613112440.png" alt="Pasted image 20240613112440.png" style="width:400px"><img src="/github-blog/images/AttachedFile/Pasted%20image%2020240613112527.png" alt="Pasted image 20240613112527.png" style="width:500px"><br>생성은 <code>ProxyFactory</code> 로직 처리는 <code>Advice</code> 특정 조건이 맞을때만 돌아가게 하는 기능은 <code>pointcut</code> 로 생성한 프록시의 경우 <a href="/github-blog/blog/c2242233">AopUtils</a> 사용 가능<code>ProxyFactory</code> 로 생성한 프록시의 경우 [[2.Ref(데이터 및 정보 저장)/Spring/공통관심사/AopUtils|AopUtils]] 사용 가능</p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">CGLIB 동일한 클래스 이름이기에 패키지 주의</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">package</span> org.aopalliance.intercept;</span><span class="line"><span class="hljs-meta">@FunctionalInterface</span>  </span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MethodInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Interceptor</span> {  </span><span class="line">  <span class="hljs-meta">@Nullable</span>  </span><span class="line">  Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(<span class="hljs-meta">@Nonnull</span> MethodInvocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable;  </span><span class="line">}</span></code></pre>
        </div>
      
<ul>
<li><code>MethodInvocation invocation</code> 다음 메서드를 호출하는 방법, 현재 프록시 객체 인스턴스, <code>args</code> 정보를 포함 (기존의 파라메터로 제공되는 부분들을 모두 안으로 들임)</li>
</ul>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  단점
                </h2>
<ul>
<li>너무 많은 설정</li>
<li>컴포넌트 스캔</li>
</ul>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  예제
                </h2>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">Advice 예제</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-meta">@Slf4j</span></span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeAdvice</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {</span><span class="line">  <span class="hljs-meta">@Override</span></span><span class="line">  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(MethodInvocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {</span><span class="line">    <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();</span><span class="line highlighted-line">    <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();</span><span class="line">    <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();</span><span class="line">    log.info(<span class="hljs-string">&quot;소요 시간: {}&quot;</span>, end - start);</span><span class="line">    <span class="hljs-keyword">return</span> result;</span><span class="line">  }</span><span class="line">}</span></code></pre>
        </div>
      

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">lambda 사용하지 않은 것과 사용하여 만든 것</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AInterface</span> {  </span><span class="line">  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span>;  </span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AInterface</span> {  </span><span class="line">  <span class="hljs-meta">@Override</span>  </span><span class="line">  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> {  </span><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;AImpl.call()&quot;</span>;  </span><span class="line">  }  </span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-meta">@Test</span>  </span><span class="line"><span class="hljs-meta">@DisplayName(&quot;인터페이스가 없으면 CGLIB를 사용&quot;)</span></span><span class="line"><span class="hljs-keyword">void</span> <span class="hljs-title function_">testObj</span><span class="hljs-params">()</span> {  </span><span class="line">  <span class="hljs-type">AInterface</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AImpl</span>();  </span><span class="line">  <span class="hljs-type">ProxyFactory</span> <span class="hljs-variable">proxyFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(a);  </span><span class="line">  proxyFactory.addAdvice(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TimeAdvice</span>());  </span><span class="line">  <span class="hljs-type">AInterface</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (AInterface) proxyFactory.getProxy();  </span><span class="line">  proxy.call();  </span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-comment">// MethodInterceptor 직접 정의하지 않은 방법</span></span><span class="line"><span class="hljs-meta">@Test</span>  </span><span class="line"><span class="hljs-meta">@DisplayName(&quot;lambda로 구현한 MethodInterceptor를 사용&quot;)</span>  </span><span class="line"><span class="hljs-keyword">void</span> <span class="hljs-title function_">testObj2</span><span class="hljs-params">()</span> {  </span><span class="line">  <span class="hljs-type">AInterface</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AImpl</span>();  </span><span class="line">  <span class="hljs-type">ProxyFactory</span> <span class="hljs-variable">proxyFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(a);  </span><span class="line">  proxyFactory.addAdvice((MethodInterceptor) invocation -&gt; {  </span><span class="line">    log.info(<span class="hljs-string">&quot;before&quot;</span>);  </span><span class="line">    <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();  </span><span class="line">    log.info(<span class="hljs-string">&quot;after&quot;</span>);  </span><span class="line">    <span class="hljs-keyword">return</span> result;  </span><span class="line">  });  </span><span class="line">  <span class="hljs-type">AInterface</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (AInterface) proxyFactory.getProxy();  </span><span class="line">  proxy.call();  </span><span class="line">}</span></code></pre>
        </div>
      

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">무조건 CGLIB 사용하는 방법</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-meta">@Test</span>  </span><span class="line"><span class="hljs-meta">@DisplayName(&quot;ProxyTargetClass를 true로 설정하면 CGLIB를 사용&quot;)</span>  </span><span class="line"><span class="hljs-keyword">void</span> <span class="hljs-title function_">proxyFactory2</span><span class="hljs-params">()</span> {  </span><span class="line">  <span class="hljs-type">AImpl</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AImpl</span>();  </span><span class="line">  <span class="hljs-type">ProxyFactory</span> <span class="hljs-variable">proxyFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(a);  </span><span class="line">  proxyFactory.setProxyTargetClass(<span class="hljs-literal">true</span>);  </span><span class="line">  proxyFactory.addAdvice(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TimeAdvice</span>());  </span><span class="line">  <span class="hljs-type">AImpl</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (AImpl) proxyFactory.getProxy();  </span><span class="line">  </span><span class="line">  log.info(<span class="hljs-string">&quot;proxy: {}&quot;</span>, proxy.getClass());  </span><span class="line">  log.info(<span class="hljs-string">&quot;proxy super: {}&quot;</span>, proxy.getClass().getSuperclass());  </span><span class="line">  proxy.save();  </span><span class="line">  </span><span class="line">  Assertions.assertTrue(AopUtils.isCglibProxy(proxy));  </span><span class="line">}</span></code></pre>
        </div>
      
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  Proxy = (Advisor = Pointcut + Advice)[]
                </h2>
<ul>
<li>포인트컷(<code>pointcut</code>) : 어디에 부가 기능을 적용할지, 어디에 부가 기능을 적용하지 않을지 판단하는 필터링 로직(주로 클래스와 메서드 이름으로 필터링)
<ul>
<li>프록시 적용 대상 여부를 체크해서 꼭 필요한 곳에만 프록시 적용(<a href="#"></a> 자동 생성)</li>
<li>프록시의 어떤 메서드가 호출 되었을 때 어드바이스를 적용할지 판단</li>
</ul>
</li>
<li>어드바이스(<code>Advice</code>) : 프록시가 호출하는 부가 기능(프록시 로직)</li>
<li>어드바이저(<code>Advisor</code>) : 하나의 포인트컷과 하나의 어드바이스를 가지고 있는 것</li>
</ul>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              
              <span class="custom-code-block-lang-text">plantuml</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-plantuml hljs"><span class="line"><span class="hljs-variable">@startuml</span></span><span class="line">title Spring AOP - Advisor, Pointcut, Advice, Proxy</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Advisor</span> </span>{</span><span class="line">  +Pointcut</span><span class="line">  +Advice</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pointcut</span> </span>{</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Advice</span> </span>{</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Proxy</span> </span>{</span><span class="line">  +Advisor[]</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line">Advisor --&gt; Pointcut : has a</span><span class="line">Advisor --&gt; Advice : has a</span><span class="line">Proxy --&gt; Advisor : contains multiple</span><span class="line"><span class="hljs-variable">@enduml</span></span></code></pre>
        </div>
      

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">pointcut</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">package</span> org.springframework.aop;  </span><span class="line">  </span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Pointcut</span> {  </span><span class="line">  <span class="hljs-type">Pointcut</span> <span class="hljs-variable">TRUE</span> <span class="hljs-operator">=</span> TruePointcut.INSTANCE;  </span><span class="line">  </span><span class="line">  ClassFilter <span class="hljs-title function_">getClassFilter</span><span class="hljs-params">()</span>;  </span><span class="line">  </span><span class="line">  MethodMatcher <span class="hljs-title function_">getMethodMatcher</span><span class="hljs-params">()</span>;  </span><span class="line">}</span></code></pre>
        </div>
      

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">MethodMatcher</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MethodMatcher</span> {  </span><span class="line">  <span class="hljs-type">MethodMatcher</span> <span class="hljs-variable">TRUE</span> <span class="hljs-operator">=</span> TrueMethodMatcher.INSTANCE;  </span><span class="line">  </span><span class="line">  <span class="hljs-type">boolean</span> <span class="hljs-title function_">matches</span><span class="hljs-params">(Method method, Class&lt;?&gt; targetClass)</span>;  </span><span class="line">  <span class="hljs-comment">// isRuntime true 일 경우 아래 함수가 호출, false 일 경우 위에 함수가 호출 (args 때문에 성능 이슈로 나눔)</span></span><span class="line">  <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRuntime</span><span class="hljs-params">()</span>;  </span><span class="line">  </span><span class="line">  <span class="hljs-type">boolean</span> <span class="hljs-title function_">matches</span><span class="hljs-params">(Method method, Class&lt;?&gt; targetClass, Object... args)</span>;  </span><span class="line">}</span></code></pre>
        </div>
      

<div class="callout" style="--callout-color: 0, 184, 148;">
  <div class="callout-title">
    <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l.293.293a1 1 0 001.414-1.414l-3-3z" clip-rule="evenodd" /></svg></div>
    <div class="callout-title-text">Tip</div>
  </div>
  <div class="callout-content">
    <p><code>advisor</code> 는 하나의 <code>Proxy</code>에  여러개를 등록 가능</p>

  </div>
</div>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">여러 advisor 등록하는 방법</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-meta">@Slf4j</span>  </span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiAdvisorTest</span> {  </span><span class="line">  <span class="hljs-meta">@Slf4j</span>  </span><span class="line">  <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Advice1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {  </span><span class="line">    <span class="hljs-meta">@Override</span>  </span><span class="line">    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(MethodInvocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {  </span><span class="line">      log.info(<span class="hljs-string">&quot;Advice1.invoke() Start&quot;</span>);  </span><span class="line">      <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();  </span><span class="line">      log.info(<span class="hljs-string">&quot;Advice1.invoke() End&quot;</span>);  </span><span class="line">      <span class="hljs-keyword">return</span> result;  </span><span class="line">    }  </span><span class="line">  }  </span><span class="line">  </span><span class="line">  <span class="hljs-meta">@Slf4j</span>  </span><span class="line">  <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Advice2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {  </span><span class="line">    <span class="hljs-meta">@Override</span>  </span><span class="line">    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(MethodInvocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {  </span><span class="line">      log.info(<span class="hljs-string">&quot;Advice2.invoke() Start&quot;</span>);  </span><span class="line">      <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();  </span><span class="line">      log.info(<span class="hljs-string">&quot;Advice2.invoke() End&quot;</span>);  </span><span class="line">      <span class="hljs-keyword">return</span> result;  </span><span class="line">    }  </span><span class="line">  }  </span><span class="line">  </span><span class="line">  <span class="hljs-meta">@Test</span>  </span><span class="line">  <span class="hljs-meta">@DisplayName(&quot;여러 Advisor 사용&quot;)</span>  </span><span class="line">  <span class="hljs-keyword">void</span> <span class="hljs-title function_">multiAdvisor</span><span class="hljs-params">()</span> {  </span><span class="line">    <span class="hljs-type">AInterface</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AImpl</span>();  </span><span class="line">    <span class="hljs-type">ProxyFactory</span> <span class="hljs-variable">proxyFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(a);  </span><span class="line">    <span class="hljs-type">DefaultPointcutAdvisor</span> <span class="hljs-variable">advisor1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultPointcutAdvisor</span>(Pointcut.TRUE, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Advice1</span>());  </span><span class="line">    <span class="hljs-type">DefaultPointcutAdvisor</span> <span class="hljs-variable">advisor2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultPointcutAdvisor</span>(Pointcut.TRUE, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Advice2</span>());  </span><span class="line">    proxyFactory.addAdvisor(advisor1);  </span><span class="line">    proxyFactory.addAdvisor(advisor2);  </span><span class="line">    <span class="hljs-type">AInterface</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (AInterface) proxyFactory.getProxy();  </span><span class="line">    proxy.call();  </span><span class="line">  }  </span><span class="line">}</span></code></pre>
        </div>
      
<p>결과는 넣은 순서대로 표기</p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              
              <span class="custom-code-block-lang-text">log</span>
            </div>
            <span class="custom-code-block-title">여러 어드바이저 등록 시 실행되는 순서는 넣은 순서대로</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-log hljs"><span class="line">10:03:56.378 [Test worker] <span class="hljs-built_in">INFO</span> hello.proxy.advisor.MultiAdvisorTest<span class="hljs-variable">$Advice1</span> - Advice1.invoke() Start</span><span class="line">10:03:56.379 [Test worker] <span class="hljs-built_in">INFO</span> hello.proxy.advisor.MultiAdvisorTest<span class="hljs-variable">$Advice2</span> - Advice2.invoke() Start</span><span class="line">10:03:56.379 [Test worker] <span class="hljs-built_in">INFO</span> hello.proxy.common.testobj.AImpl - AImpl.call()</span><span class="line">10:03:56.380 [Test worker] <span class="hljs-built_in">INFO</span> hello.proxy.advisor.MultiAdvisorTest<span class="hljs-variable">$Advice2</span> - Advice2.invoke() End</span><span class="line">10:03:56.380 [Test worker] <span class="hljs-built_in">INFO</span> hello.proxy.advisor.MultiAdvisorTest<span class="hljs-variable">$Advice1</span> - Advice1.invoke() End</span></code></pre>
        </div>
      
<h3 style="color: #C792EA;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h3</span>
                  직접 만들어서 써보는 pointcut
                </h3>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">직접 만들어보는 pointcut</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AInterface</span> {  </span><span class="line">  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span>;  </span><span class="line">  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">func</span><span class="hljs-params">()</span>;  </span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-meta">@Slf4j</span>  </span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AInterface</span> {  </span><span class="line">  <span class="hljs-meta">@Override</span>  </span><span class="line">  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> {  </span><span class="line">    log.info(<span class="hljs-string">&quot;AImpl.call()&quot;</span>);  </span><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;AImpl.call()&quot;</span>;  </span><span class="line">  }  </span><span class="line">  </span><span class="line">  <span class="hljs-meta">@Override</span>  </span><span class="line">  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">func</span><span class="hljs-params">()</span> {  </span><span class="line">    log.info(<span class="hljs-string">&quot;AImpl.func()&quot;</span>);  </span><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;AImpl.func()&quot;</span>;  </span><span class="line">  }  </span><span class="line">}</span><span class="line">&nbsp;</span><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMethodMatcher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodMatcher</span> {  </span><span class="line">  <span class="hljs-meta">@Override</span>  </span><span class="line">  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">matches</span><span class="hljs-params">(Method method, Class&lt;?&gt; targetClass)</span> {  </span><span class="line">    <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.getName().equals(<span class="hljs-string">&quot;call&quot;</span>);  </span><span class="line">    log.info(<span class="hljs-string">&quot;MethodMatcher.matches() method: {} targetClass: {} result: {}&quot;</span>, method.getName(), targetClass, result);  </span><span class="line">    <span class="hljs-keyword">return</span> result;  </span><span class="line">  }  </span><span class="line">  </span><span class="line">  <span class="hljs-meta">@Override</span>  </span><span class="line">  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRuntime</span><span class="hljs-params">()</span> {  </span><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  </span><span class="line">  }  </span><span class="line">  </span><span class="line">  <span class="hljs-meta">@Override</span>  </span><span class="line">  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">matches</span><span class="hljs-params">(Method method, Class&lt;?&gt; targetClass, Object[] args)</span> {  </span><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  </span><span class="line">  }  </span><span class="line">}  </span><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPointcut</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Pointcut</span> {  </span><span class="line">  <span class="hljs-meta">@Override</span>  </span><span class="line">  <span class="hljs-keyword">public</span> ClassFilter <span class="hljs-title function_">getClassFilter</span><span class="hljs-params">()</span> {  </span><span class="line">    <span class="hljs-keyword">return</span> ClassFilter.TRUE;  </span><span class="line">  }  </span><span class="line">  </span><span class="line">  <span class="hljs-meta">@Override</span>  </span><span class="line">  <span class="hljs-keyword">public</span> MethodMatcher <span class="hljs-title function_">getMethodMatcher</span><span class="hljs-params">()</span> {  </span><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyMethodMatcher</span>();  </span><span class="line">  }  </span><span class="line">}  </span><span class="line">  </span><span class="line"><span class="hljs-meta">@Test</span>  </span><span class="line"><span class="hljs-meta">@DisplayName(&quot;직접 만든 Pointcut을 사용&quot;)</span>  </span><span class="line"><span class="hljs-keyword">void</span> <span class="hljs-title function_">advisorTest2</span><span class="hljs-params">()</span> {  </span><span class="line">  <span class="hljs-type">AInterface</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AImpl</span>();  </span><span class="line">  <span class="hljs-type">ProxyFactory</span> <span class="hljs-variable">proxyFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(a);  </span><span class="line">  <span class="hljs-type">DefaultPointcutAdvisor</span> <span class="hljs-variable">advisor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultPointcutAdvisor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPointcut</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">TimeAdvice</span>());  </span><span class="line">  proxyFactory.addAdvisor(advisor);  </span><span class="line">  <span class="hljs-type">AInterface</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (AInterface) proxyFactory.getProxy();  </span><span class="line">  proxy.call();  </span><span class="line">  proxy.func();  </span><span class="line">}</span></code></pre>
        </div>
      
<h3 style="color: #C792EA;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h3</span>
                  Spring 제공하는 pointcut
                </h3>
<ul>
<li><code>NameMatchMethodPointcut</code> : 메서드 이름 기반으로 매칭. 내부에서 <a href="/github-blog/blog/5dd120c8">PatternMatchUtils</a> 사용</li>
<li><code>JdkRegexpMethodPointcut</code> : JDK 정규 표현식을 기반으로 포인트컷을 생성</li>
<li><code>TruePointcut</code> : 항상 동작하는 포인트컷</li>
<li><code>AnnotationMatchingPointcut</code> : 어노테이션으로 매칭</li>
<li><code>AspectJExpressionPointcut</code> : aspectJ 표현식으로 매칭 (가장 많이 사용)</li>
</ul>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">스프링이 제공하는 pointcut 사용</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-meta">@Test</span>  </span><span class="line"><span class="hljs-meta">@DisplayName(&quot;스프링이 제공하는 Pointcut을 사용&quot;)</span>  </span><span class="line"><span class="hljs-keyword">void</span> <span class="hljs-title function_">advisorTest3</span><span class="hljs-params">()</span> {  </span><span class="line">  <span class="hljs-type">AInterface</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AImpl</span>();  </span><span class="line">  <span class="hljs-type">ProxyFactory</span> <span class="hljs-variable">proxyFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(a);  </span><span class="line">  <span class="hljs-type">NameMatchMethodPointcut</span> <span class="hljs-variable">pointcut</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NameMatchMethodPointcut</span>();  </span><span class="line">  pointcut.addMethodName(<span class="hljs-string">&quot;call&quot;</span>);  </span><span class="line">  <span class="hljs-type">DefaultPointcutAdvisor</span> <span class="hljs-variable">advisor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultPointcutAdvisor</span>(pointcut, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TimeAdvice</span>());  </span><span class="line">  proxyFactory.addAdvisor(advisor);  </span><span class="line">  <span class="hljs-type">AInterface</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (AInterface) proxyFactory.getProxy();  </span><span class="line">  proxy.call();  </span><span class="line">  proxy.func();  </span><span class="line">}</span></code></pre>
        </div>
      
<h1 style="color: #82AAFF;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h1</span>
                  BeanPostProcessor(빈 후처리기)
                </h1>
<p>후킹같은 기능<br>로 이동<br>보통 후처리기의 적용 조건은 <a href="#">IOC 컨테이너</a>로 이동
보통 후처리기의 적용 조건은 <code>pointcut</code>을 이용해서 적용할지 말지 선택</p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">BeanPostProcessor</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanPostProcessor</span> {</span><span class="line">  <span class="hljs-meta">@Nullable</span></span><span class="line">  <span class="hljs-keyword">default</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException {</span><span class="line">    <span class="hljs-keyword">return</span> bean;</span><span class="line">  }</span><span class="line">&nbsp;</span><span class="line">  <span class="hljs-meta">@Nullable</span></span><span class="line">  <span class="hljs-keyword">default</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException {</span><span class="line">    <span class="hljs-keyword">return</span> bean;</span><span class="line">  }</span><span class="line">}</span></code></pre>
        </div>
      
<ul>
<li><code>postProcessBeforeInitialization()</code> : 객체 생성 이후에 <a href="/github-blog/blog/4e178d59">@PostConstruct</a> 같은 초기화가 발생하기 전에 호출되는 포스트 프로세서</li>
<li><code>postProcessAfterInitialization()</code> : 객체 생성 이후에 <a href="/github-blog/blog/4e178d59">@PostConstruct</a> 같은 초기화 발생한 다음에 호출되는 포스트 프로세서</li>
</ul>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">특정 packageName 이 포함된 Bean 들만 Proxy 설정</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-meta">@Slf4j</span></span><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PackageLogTracePostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanPostProcessor</span> {</span><span class="line">  <span class="hljs-comment">// 특정 패키지 하위의 빈들만 적용</span></span><span class="line">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String basePackage;</span><span class="line">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Advisor advisor;</span><span class="line">&nbsp;</span><span class="line">  <span class="hljs-keyword">public</span> <span class="hljs-title function_">PackageLogTracePostProcessor</span><span class="hljs-params">(String basePackage, Advisor advisor)</span> {</span><span class="line">    <span class="hljs-built_in">this</span>.basePackage = basePackage;</span><span class="line">    <span class="hljs-built_in">this</span>.advisor = advisor;</span><span class="line">  }</span><span class="line">&nbsp;</span><span class="line">  <span class="hljs-meta">@Override</span></span><span class="line">  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException {</span><span class="line">    log.info(<span class="hljs-string">&quot;PackageLogTracePostProcessor.postProcessAfterInitialization() Start&quot;</span>);</span><span class="line">    log.info(<span class="hljs-string">&quot;bean: {} / beanName: {}&quot;</span>, bean.getClass(), beanName);</span><span class="line">&nbsp;</span><span class="line">    <span class="hljs-comment">// 프록시 대상여부 체크</span></span><span class="line">    <span class="hljs-type">String</span> <span class="hljs-variable">packageName</span> <span class="hljs-operator">=</span> bean.getClass().getPackageName();</span><span class="line">&nbsp;</span><span class="line">    <span class="hljs-keyword">if</span> (!packageName.startsWith(basePackage)) {</span><span class="line">      <span class="hljs-keyword">return</span> bean;</span><span class="line">    }</span><span class="line">    </span><span class="line">    <span class="hljs-comment">// 프록시 생성</span></span><span class="line">    <span class="hljs-type">ProxyFactory</span> <span class="hljs-variable">proxyFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>(bean);</span><span class="line">    proxyFactory.addAdvisor(advisor);</span><span class="line">    <span class="hljs-type">Object</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> proxyFactory.getProxy();</span><span class="line">&nbsp;</span><span class="line">    log.info(<span class="hljs-string">&quot;target: {} / proxy: {}&quot;</span>, bean.getClass(), proxy.getClass());</span><span class="line">    log.info(<span class="hljs-string">&quot;PackageLogTracePostProcessor.postProcessAfterInitialization() End&quot;</span>);</span><span class="line">    <span class="hljs-keyword">return</span> proxy;</span><span class="line">  }</span><span class="line">}</span></code></pre>
        </div>
      
<h1 style="color: #82AAFF;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h1</span>
                  스프링이 제공하는 빈 후처리기
                </h1>
<p>==여기서부터는 사실 <a href="/github-blog/blog/ee2323b8">AOP</a>  아니냐?==</p>
<p><span class="custom-inline-code"><span class="custom-inline-code-title"><span class="custom-inline-code-icon"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><title>Gradle</title><path d="M22.695 4.297a3.807 3.807 0 0 0 -5.29 -0.09 0.368 0.368 0 0 0 0 0.533l0.46 0.47a0.363 0.363 0 0 0 0.474 0.032 2.182 2.182 0 0 1 2.86 3.291c-3.023 3.02 -7.056 -5.447 -16.211 -1.083a1.24 1.24 0 0 0 -0.534 1.745l1.571 2.713a1.238 1.238 0 0 0 1.681 0.461l0.037 -0.02 -0.029 0.02 0.688 -0.384a16.083 16.083 0 0 0 2.193 -1.635 0.384 0.384 0 0 1 0.499 -0.016 0.357 0.357 0 0 1 0.016 0.534 16.435 16.435 0 0 1 -2.316 1.741H8.77l-0.696 0.39a1.958 1.958 0 0 1 -0.963 0.25 1.987 1.987 0 0 1 -1.726 -0.989L3.9 9.696C1.06 11.72 -0.686 15.603 0.26 20.522a0.363 0.363 0 0 0 0.354 0.296h1.675a0.363 0.363 0 0 0 0.37 -0.331 2.478 2.478 0 0 1 4.915 0 0.36 0.36 0 0 0 0.357 0.317h1.638a0.363 0.363 0 0 0 0.357 -0.317 2.478 2.478 0 0 1 4.914 0 0.363 0.363 0 0 0 0.358 0.317h1.627a0.363 0.363 0 0 0 0.363 -0.357c0.037 -2.294 0.656 -4.93 2.42 -6.25 6.108 -4.57 4.502 -8.486 3.088 -9.9zm-6.229 6.901 -1.165 -0.584a0.73 0.73 0 1 1 1.165 0.587z" stroke-width="1"></path></svg></span><span class="custom-inline-code-title-text">필수 필요</span></span><code class="hljs gradle">implementation <span class="hljs-string">&#x27;org.springframework.boot:spring-boot-starter-aop&#x27;</span></code></span><br>스프링 부트가 없던 시절에는  를 직접 사용해야 적용이 되었는데 이제는 스프링 부트가 알아서 사용<br> 이라는 자동 프록시 생성기를 등록<br> 를 직접 사용해야 적용이 되었는데 이제는 스프링 부트가 알아서 사용
해당 설정을 하는 경우 <code>AutoProxyCreator</code> 이라는 자동 프록시 생성기를 등록
<code>AnnotationAwareAspectJAutoProxyCreator</code> 라는 빈 후처리기가 스프링 빈에 자동 등록</p>
<p><code>AnnotationAwareAspectJAutoProxyCreator</code> : 스프링 빈으로 등록된 <code>Advisor</code>들을 자동으로 찾아서 프록시가 필요한 곳에 자동으로 프록시를 적용</p>
<p>과정<br>스프링이 @Bean -> 자동 프록시 생성기<br>자동 프록시 생성기 -> 스프링 컨테이너에 Advisor 모두 조회<br>Advisor 들을 등록하려는 @Bean 에 적용 가능한지 포인트컷 확인</p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              
              <span class="custom-code-block-lang-text">plantuml</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-plantuml hljs"><span class="line"><span class="hljs-meta">@startuml</span></span><span class="line">title Spring AOP - AnnotationAwareAspectJAutoProxyCreator 진행 과정</span><span class="line">&nbsp;</span><span class="line">skinparam participant {</span><span class="line">    BackgroundColor LightBlue</span><span class="line">    BorderColor DarkGray</span><span class="line">}</span><span class="line">&nbsp;</span><span class="line">autonumber <span class="hljs-string">&quot;&lt;b&gt;[#번#]&lt;/b&gt;&quot;</span></span><span class="line">&nbsp;</span><span class="line">participant <span class="hljs-string">&quot;서버 프로세스&quot;</span> as a <span class="hljs-comment">#Yellow</span></span><span class="line">participant <span class="hljs-string">&quot;자동 프록시 생성기&quot;</span> as b <span class="hljs-comment">#LightGreen</span></span><span class="line">participant <span class="hljs-string">&quot;스프링 컨테이너&quot;</span> as c <span class="hljs-comment">#LightPink</span></span><span class="line">participant <span class="hljs-string">&quot;BeanFactoryAspectJAdivisorsBuilder&quot;</span> as d <span class="hljs-comment">#LightBlue</span></span><span class="line">&nbsp;</span><span class="line">b -&gt; c : <span class="hljs-variable">&lt;color blue&gt;</span><span class="hljs-meta">@Aspect</span> 어노테이션 등록된 빈 조회<span class="hljs-variable">&lt;/color&gt;</span></span><span class="line">b -&gt; d : <span class="hljs-variable">&lt;color blue&gt;</span><span class="hljs-meta">@Aspect</span> 어노테이션이 있는 빈들 모두 전달<span class="hljs-variable">&lt;/color&gt;</span></span><span class="line">d -&gt; d : <span class="hljs-variable">&lt;color blue&gt;</span><span class="hljs-meta">@Aspect</span> 내부 정보를 이용해 Advisor 생성하여 내부 캐시<span class="hljs-variable">&lt;/color&gt;</span></span><span class="line">&nbsp;</span><span class="line">a -&gt; b : <span class="hljs-variable">&lt;color red&gt;</span><span class="hljs-meta">@Bean</span> 객체 전달<span class="hljs-variable">&lt;/color&gt;</span></span><span class="line">b -&gt; c : <span class="hljs-variable">&lt;color green&gt;</span>Advisor Bean 모두 가져오기<span class="hljs-variable">&lt;/color&gt;</span></span><span class="line">b -&gt; d : <span class="hljs-variable">&lt;color green&gt;</span><span class="hljs-meta">@Aspect</span> Advisor 모두 가져오기<span class="hljs-variable">&lt;/color&gt;</span></span><span class="line">b -&gt; b : <span class="hljs-variable">&lt;color red&gt;</span><span class="hljs-meta">@Bean</span> 객체가 Advisor의 Pointcut 조건에 맞는 모든 Advisor 적용하여 Proxy 객체 생성<span class="hljs-variable">&lt;/color&gt;</span></span><span class="line">b -&gt; c : <span class="hljs-variable">&lt;color red&gt;</span><span class="hljs-meta">@Bean</span> 객체 또는 적용된 Proxy 객체 등록<span class="hljs-variable">&lt;/color&gt;</span></span><span class="line"><span class="hljs-meta">@enduml</span></span></code></pre>
        </div>
      
<ul>
<li><code>BeanFactoryAspectJAdivisorsBuilder</code> : <code>@Aspect</code> 정보를 기반으로 <code>pointcut</code>, <code>Advice</code>, <code>Advisor</code> 생성하고 보관<br> 정보를 기반으로 어드바이저를 만들고 Aspect 빌더 내부 저장소에 캐시<br>캐시에 어드바이저가 만들어져 있는 경우 저장된 어드바이저 반환 정보를 기반으로 어드바이저를 만들고 Aspect 빌더 내부 저장소에 캐시
캐시에 어드바이저가 만들어져 있는 경우 저장된 어드바이저 반환</li>
</ul>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  AOP 에서 거진 이것만 쓰는 pointcut AspectJExpressionPointcut
                </h2>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">AspectJExpressionPointcut 사용 예시</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-meta">@Bean</span>  </span><span class="line"><span class="hljs-keyword">public</span> Advisor <span class="hljs-title function_">advisor2</span><span class="hljs-params">(LogTrace logTrace)</span> {  </span><span class="line">  <span class="hljs-type">AspectJExpressionPointcut</span> <span class="hljs-variable">pointcut</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AspectJExpressionPointcut</span>();  </span><span class="line">  pointcut.setExpression(<span class="hljs-string">&quot;execution(* hello.proxy.app..*(..))&quot;</span>);  </span><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultPointcutAdvisor</span>(pointcut, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogTraceAdvice</span>(logTrace));  </span><span class="line">}</span></code></pre>
        </div>
      
<ul>
<li><code>*</code> : 모든 반환 타입</li>
<li><code>hello.proxy.app..</code> : 해당 패키지와 그 하위 패키지</li>
<li><code>*(..)</code> : <code>*</code> 모든 메서드 이름, <code>(..)</code> 파라메터 상관 없음</li>
</ul>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            <span class="custom-code-block-title">noLog 라는 함수만 적용 안하는 방법</span>
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-meta">@Bean</span>  </span><span class="line"><span class="hljs-keyword">public</span> Advisor <span class="hljs-title function_">advisor3</span><span class="hljs-params">(LogTrace logTrace)</span> {  </span><span class="line">  <span class="hljs-type">AspectJExpressionPointcut</span> <span class="hljs-variable">pointcut</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AspectJExpressionPointcut</span>();  </span><span class="line">  pointcut.setExpression(<span class="hljs-string">&quot;execution(* hello.proxy.app..*(..)) &amp;&amp; !exclude(* hello.proxy.app..noLog*(..))&quot;</span>);  </span><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultPointcutAdvisor</span>(pointcut, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogTraceAdvice</span>(logTrace));  </span><span class="line">}</span></code></pre>
        </div>
      
<h1 style="color: #82AAFF;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h1</span>
                  AOP
                </h1>
<p><a href="/github-blog/blog/ee2323b8">AOP</a><br><a href="/github-blog/blog/ce20fca8">AspectJ</a><br><a href="/github-blog/blog/cd416d78">@Aspect</a><br>AOP 내용은 너무 많아서 분할<br>애초에 자주 사용되는 내용은 AOP</p>
<p><a href="/github-blog/blog/ee2323b8">AOP</a></p>
15:T80ae,---
aliases:
  - Proxy
  - Dynamic Proxy
  - CGLIB
  - 프록시
  - Interface Proxy
  - Class Proxy
  - ProxyFactory
  - BeanPostProcessor
tags:
  - Java
  - Spring
특징:
---
# Proxy
Proxy(대리인)

초기화 지연, 접근 제어, 로깅, 캐싱 등, 기존 대상 원본 객체를 수정 없이 추가 동작 기능들을 가미하고 싶을 때 사용하는 코드 패턴

**`RealSubject`는 자신의 기능에만 집중을 하고** 그 이외 **부가 기능을 제공하거나 접근을 제어하는 역할을 `Proxy` 객체에게 위임**
이로 인해 `SOLID`원칙 중 `OCP`와 `SRP`를 지향하는 코드로 작성이 가능
![[config/AttachedFile/SRP.png|800]]

Wrapper 기능과 같은게 아닌가 생각 듬 (똑같은 이름으로 기능만 추가하는 방식)
이러니 [[2.Ref(데이터 및 정보 저장)/Spring/공통관심사/AOP|AOP]] 기능을 만들때 사용 될 듯
하지만 단점은 역시 `interface` 가 필요하고 상속 받아 대상을 실행하면서 추가적인 기능을 넣어야하기 때문에 소스가 굉장히 많아지기 때문에 소스가 지저분함
## 주요 기능
- 접근 제어
	- 권한에 따른 접근 차단
	- 캐싱
	- 지연 로딩
- 부가 기능 추가
	- 원래 서버가 제공하는 기능에 더해서 부가 기능을 수행
		- 요청 값이나 응답 값을 중간에 변형
		- 실행 시간을 측정
## 장점
- 기존 객체를 수정하지 않고 일련의 로직을 프록시 패턴을 통해 추가
- 실제 객체를 수행하기 이전에 전처리를 하거나, 기존 객체를 캐싱할 수 있음
## 단점
- 객체 생성시 한단계 거치게 됨으로 빈번한 객체 생성이 필요해서 성능 저하(and 귀찮음)
- 계층이 추가되어 코드의 복잡도 증가 (로직이 너무 난해하고 복잡해짐)
## 예제
Interface Proxy 와 Class Proxy 차이
- 클래스 프록시는 해당 클래스에만 적용 가능 / 인터페이스 프록시는 인터페이스만 같으면 모든 곳에 적용 가능
- 클래스 프록시는 상속을 사용하기 때문에 몇가지 제약 발생
	- 부모 클래스의 생성자를 호출 필요
	- 클래스에 final 키워드가 붙으면 상속 불가
	- 메서드에 final 키워드가 붙으면 [[2.Ref(데이터 및 정보 저장)/개발 이론/오버라이딩 (overriding)|오버라이딩 (overriding)]] 불가
- 인터페이스 프록시는 캐스팅 단점
### Interface Proxy

![[config/AttachedFile/proxy-sample.png]]

```java title:"Proxy 사용하여 A 로직 시간 측정"
interface AInterface {
    String call();
}

class AImpl implements AInterface {
    @Override
    public String call() {
        System.out.println("A 호출");
        return "a";
    }
}

class AProxy implements AInterface {
    AInterface subject;

    AProxy(AInterface subject) {
        this.subject = subject;
    }

    @Override
    public String call() {
        System.out.println("TimeProxy 실행");
        long startTime = System.nanoTime();

        String result = subject.call();

        long endTime = System.nanoTime();
        long resultTime = endTime - startTime;
        System.out.println("TimeProxy 종료 resultTime = " + resultTime);

        return result;
    }
}
```

```java title:"Proxy 사용하여 B 로직 시간 측정"
interface BInterface {
    String call();
}

class BImpl implements BInterface {
    @Override
    public String call() {
        System.out.println("B 호출");
        return "b";
    }
}

class BProxy implements BInterface {
    BInterface subject;

    BProxy(BInterface subject) {
        this.subject = subject;
    }

    @Override
    public String call() {
        System.out.println("TimeProxy 실행");
        long startTime = System.nanoTime();

        String result = subject.call();

        long endTime = System.nanoTime();
        long resultTime = endTime - startTime;
        System.out.println("TimeProxy 종료 resultTime = " + resultTime);

        return result;
    }
}
```

```java title:"똑같은 로직인데 그냥 같은 인터페이스 썻어도 되지 않나 싶지만 어쨋든 불필요한 소스가 낭비된다는걸 보여주는거니까"
public class Client {
    public static void main(String[] args) {
        AInterface proxyA = new AProxy(new AImpl());
        proxyA.call();

        BInterface proxyB = new BProxy(new BImpl());
        proxyB.call();
    }
}
```

해당 예제에서 알 수 있듯이 Proxy 클래스를 만드느라 불필요한 소스가 굉장히 많이 낭비되고 소스 읽기도 힘듬

### Class Proxy
```java title:"인터페이스를 사용하지 않은 프록시"
@Slf4j  
public class ConcreteLogic {  // target Logic
  public String operation() {  
    log.info("ConcreteLogic.operation()");  
    return "ConcreteLogic Data";  
  }  
}

@Slf4j  
public class TimeProxy extends ConcreteLogic {  // Proxy
  private ConcreteLogic concreteLogic;  
  
  public TimeProxy(ConcreteLogic concreteLogic) {  
    this.concreteLogic = concreteLogic;  
  }  
  
  @Override  
  public String operation() {  
    log.info("TimeProxy.operation()");  
    long start = System.currentTimeMillis();  
    String result = concreteLogic.operation();  
    long end = System.currentTimeMillis();  
    log.info("Time: " + (end - start));  
    return result;  
  }  
}

public class ConcreteClient {  
  private final ConcreteLogic concreteLogic;  
  
  public ConcreteClient(ConcreteLogic concreteLogic) {  
    this.concreteLogic = concreteLogic;  
  }  
  
  public void execute() {  
    concreteLogic.operation();  
  }
}

@Test  
void addProxy() {  //실행
  ConcreteLogic concreteLogic = new ConcreteLogic();  
  TimeProxy timeProxy = new TimeProxy(concreteLogic);  
  ConcreteClient concreteClient = new ConcreteClient(timeProxy);  
  concreteClient.execute();  
}
```


# Dynamic Proxy
Proxy 의 단점을 보안하기 위해 컴파일 시점이 아닌 런타임 시점에 프록시를 만들어주는 방식을 동적 프록시 라고 함
java 에서 제공하는 [[2.Ref(데이터 및 정보 저장)/Spring/공통관심사/Reflection|Reflection]] 기능을 사용

```java
public class Proxy implements java.io.Serializable {
@CallerSensitive  
public static Object newProxyInstance(ClassLoader loader,  // 클래스 로더
                                      Class<?>[] interfaces, // 타겟의 인터페이스
                                      InvocationHandler h) {...} // 타깃의 정보가 포함된 Handler
}
```

- `ClassLoader loader`
	- 프록시 클래스를 만들 클래스 로더(Class Loader)
	- Proxy 객체가 구현할 Interface에 Class Loader 를 얻어오는 것이 일반적
- `Class<?>[] interfaces`
	- 프록시 클래스가 구현하고자 하는 인터페이스 목록(배열)
	- 메서드를 통해 생성 될 Proxy 객체가 구현할 Interface를 정의
- `InvocationHandler h`
	- 프록시의 메서드(invoke)가 호출되었을때 실행되는 핸들러 메서드

`invoke()` 메서드는 동적 프록시의 메서드가 호출되었을때, 이를 낚아채어 대신 실행되는 메서드
메서드 [[2.Ref(데이터 및 정보 저장)/개발 이론/Parameter|파라메터]] 를 통해 어떤 메서드가 실행되었는지 메서드 정보와 메서드에 전달된 인자까지 알 수 있음
```java
public interface InvocationHandler {
    public Object invoke(Object proxy, Method method, Object[] args)
        throws Throwable;
}
```
- `Object proxy` : 프록시 객체
- `Method method` : 호출한 메서드 정보
- `Object[] args` : 메서드에 전달된 매개변수 (배열)

## 단점
- 타입을 무조건 `interface` 로 넣어줘야함
	- 해당 방법을 해결하기 위해 CGLIB 를 이용해서 바이트코드를 조작해서 동적 프록시 기술을 응용하는 라이브러리로 해결할 수 있음
	- 스프링에서는 인터페이스가 있을 경우 JDK Dynamic Proxy 를 사용하며 클래스의 경우 [[#CGLIB 라이브러리]]를 사용
## 예제
![[config/AttachedFile/dynamic-proxy.png]]

```java
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

// InvocationHandler 프록시 메서드 핸들러를 클래스 필드 변수를 이용해야 하기 때문에 재정의 함
class MyProxyHandler implements InvocationHandler {
    private final Object target;

    MyProxyHandler(Object target) {
        this.target = target;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println("TimeProxy 실행");
        long startTime = System.nanoTime();

        Object result = method.invoke(target, args); // 파라미터로 전달받은 메서드를 invoke로 실행

        long endTime = System.nanoTime();
        long resultTime = endTime - startTime;
        System.out.println("TimeProxy 종료 resultTime = " + resultTime);

        return result;
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
    
        AInterface proxyA = (AInterface) Proxy.newProxyInstance(
                AInterface.class.getClassLoader(),
                new Class[]{AInterface.class},
                new MyProxyHandler(new AImpl())
        );
        proxyA.call();

        BInterface proxyB = (BInterface) Proxy.newProxyInstance(
                BInterface.class.getClassLoader(),
                new Class[]{BInterface.class},
                new MyProxyHandler(new BImpl())
        );
        proxyB.call();
    }
}
```

### 메서드 필터링 예제
```java
interface AInterface {
    String call();
    void print();
    void run();
}

class AImpl implements AInterface {
    @Override
    public String call() {
        System.out.println("A 호출");
        return "a";
    }

    @Override
    public void print() {
        System.out.println("A print @@@@@@@");
    }

    @Override
    public void run() {
        System.out.println("A Running !!!!!!!!!");
    }
}


public class Client {
    public static void main(String[] arguments) {

        AInterface proxyA = (AInterface) Proxy.newProxyInstance(
                AInterface.class.getClassLoader(),
                new Class[]{AInterface.class},
                (proxy, method, args) -> {
                    Object target = new AImpl();

                    // 실행한 메서드가 call 일 경우 로깅 기능을 가미하여 리턴
                    if(method.getName().equals("call")) {
                        System.out.println("TimeProxy 실행");
                        long startTime = System.nanoTime();

                        Object result = method.invoke(target, args); // 파라미터로 전달받은 메서드를 invoke로 실행

                        long endTime = System.nanoTime();
                        long resultTime = endTime - startTime;
                        System.out.println("TimeProxy 종료 resultTime = " + resultTime);

                        return result;
                    }

                    // 만일 메서드가 run이나 print 일경우 로깅 기능을 가미하지않고 그냥 그대로 원본 대상 객체의 메서드를 실행하고 리턴하도록 지정
                    return method.invoke(target, args);
                }
        );

        proxyA.call();
        proxyA.print();
        proxyA.run();
    }
}
```
> 람다 방식으로 작성
# CGLIB 라이브러리
[[#Dynamic Proxy]]의 단점을 해결할 수 있는 라이브러리 
`JDK`의 `Dynamic Proxy` 와는 다르게 인터페이스가 아닌 클래스를 대상으로 `ByteCode`를 조작해 프록시 생성할 수 있는 라이브러리
오히려 `Dynamic Proxy` 비해서 성능이 좋으며 그 효과로 인해 스프링 프레임워크에 기본으로 내장

스프링 프로젝트가 아닌 일반 자바 프로젝트의 경우 외부 라이브러리 다운 & 적용이 필요
[CGLIB 다운로드](https://github.com/cglib/cglib/releases/tag/RELEASE_3_3_0) 다른 버전은 알아서 찾아

```java
import net.sf.cglib.proxy.*; // cglib 임포트 (다운 받아서 사용할때)
import org.springframework.cglib.proxy.*;  // cglib 임포트 (Spring 내부에서 사용할 때)
```
> import 위치
```java
public Object intercept(
	Object o,                    // CGLIB가 적용된 객체
	Method method,               // 호출된 메서드
	Object[] args,               // 메서드를 호출하면서 전달된 인수
	MethodProxy methodProxy      // 메서드 호출에 사용
) throws Throwable {}
```
## 단점
- 기본적으로 **클래스 상속(extends)를 통해 프록시 구현**이 되기 때문에 타겟 클래스가 상속이 불가능할때는 당연히 프록시 등록이 불가능
- 메서드에 final 키워드가 붙게 되면 해당 메서드를 오버라이딩하여 사용 할 수 없기 때문에 결과적으로 프록시 메서드 로직이 동작하지 않음
- 통합적으로 상속에 있어서 제한이 있는 대상은 사용이 불가능
## 사용이 불가능한 상황
- 추상 클래스(abstract class)
- 클래스의 생성자를 private 하여 생성자를 제한할 경우
- 기본 생성자가 없는 경우 사용 불가
- 생성자 2번 호출 문제
	- 실제 target 객체를 생성할 때
	- 프록시 객체를 생성할 때 부모 클래스의 생성자 호출
- `final` 키워드 사용하는 클래스 또는 메서드 사용 불가

`final` 은 에러는 안뜨는데 아무런 에러 없이 `Proxy` 동작하지 않음
추상클래스(`abstract class`)와 생성자를 `private` 경우 컴파일 단계에서 에러가 뜸

## Spring 의 대응한 해결 방법
- Spring 4.0 이상부터 CGLIB 기본 생상자가 필수인 문제를 해결
	- `objenesis`라는 라이브러리를 이용해서 기본 생성자 없이 객체 생성 가능하도록 추가
	  해당 라이브러리는 생성자 호출 없이 객체를 생성할 수 있게 해줌
- 생성자 2번 호출 문제
	- `objenesis` 사용으로 생성자 호출 없이 객체 생성으로 생성자 1번만 호출
- Spring boot 2.0 이상부터 CGLIB 기본 사용
`{properties icon title:"강제로 CGLIB 사용하도록 선택하는 방법(이미 default 값)"}spring.aop.proxy-target-class=true

## 예제
```java title:"모두 풀어서 쓰는 방법 (추천x)"
import org.springframework.cglib.proxy.*;  
import java.lang.reflect.Method;
// 프록시 핸들러
class MyProxyInterceptor implements MethodInterceptor {

    private final Object target;

    MyProxyInterceptor(Object target) {
        this.target = target;
    }

    @Override
    public Object intercept(
            Object o,
            Method method,
            Object[] args,
            MethodProxy methodProxy
    ) throws Throwable {

        System.out.println("TimeProxy 실행");
        long startTime = System.nanoTime();

        //Object result = method.invoke(target, args); // 파라미터로 전달받은 메서드를 invoke로 실행
        Object result = methodProxy.invoke(target, args); // MethodProxy 사용하는 것이 속도적으로 조금 더 빠르다함

        long endTime = System.nanoTime();
        long resultTime = endTime - startTime;
        System.out.println("TimeProxy 종료 resultTime = " + resultTime);

        return result;
    }
}

// 프록시를 적용할 대상 타켓
class Subject {
    public void call() {
        System.out.println("서비스 호출");
    }
}

public class Client {
    public static void main(String[] arguments) {

        // 1. 프록시 등록 (CGLIB는 Enhancer를 사용해서 프록시를 등록한다)
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(Subject.class); // CGLIB는 구체 클래스를 상속 받아서 프록시를 생성하기 때문에 상혹할 구체 클래스를 지정
        enhancer.setCallback(new MyProxyInterceptor(new Subject())); // 프록시 핸들러 할당

        // 2. 프록시 생성
        Subject proxy = (Subject) enhancer.create(); // setSuperclass() 에서 지정한 클래스를 상속 받아서 프록시가 만들어진다.

        // 3. 프록시 호출
        proxy.call();
    }
}
```

```java title:"간략하게 람다 방식을 사용하는 방법"
public class Client {
    public static void main(String[] arguments) {
        
        Subject proxy = (Subject) Enhancer.create(Subject.class, (MethodInterceptor) (o, method, args, methodProxy) -> {
            Subject target = new Subject();
            System.out.println("TimeProxy 실행");
            long startTime = System.nanoTime();
            // Object result = method.invoke(target, args); // 파라미터로 전달받은 메서드를 invoke로 실행
            Object result = methodProxy.invoke(target, args); // MethodProxy 사용하는 것이 속도적으로 조금 더 빠르다함
            long endTime = System.nanoTime();
            long resultTime = endTime - startTime;
            System.out.println("TimeProxy 종료 resultTime = " + resultTime);
            return result;
        });
        
        proxy.call();
    }
}
```
> 람다 방식으로 소스 작성

# ProxyFactory
Spring 지원하는 프록시 방법
[[#Dynamic Proxy]]와 [[#CGLIB 라이브러리]] 방법을 둘 다 상황에 따라 지원해주는 `ProxyFactory` 방법
[[#Dynamic Proxy]] 에서 사용하는 `InvocationHandler` 클래스와 [[#CGLIB 라이브러리]] 에서 사용하는 `MethodInterceptor` 둘 다 지원하기 위한 `Advice`를 제공

![[config/AttachedFile/Pasted image 20240613112440.png|400]]![[config/AttachedFile/Pasted image 20240613112527.png|500]]
생성은 `ProxyFactory` 로직 처리는 `Advice` 특정 조건이 맞을때만 돌아가게 하는 기능은 `pointcut` 개념을 지원
`ProxyFactory` 로 생성한 프록시의 경우 [[2.Ref(데이터 및 정보 저장)/Spring/공통관심사/AopUtils|AopUtils]] 사용 가능

```java title:"CGLIB 동일한 클래스 이름이기에 패키지 주의"
package org.aopalliance.intercept;
@FunctionalInterface  
public interface MethodInterceptor extends Interceptor {  
  @Nullable  
  Object invoke(@Nonnull MethodInvocation invocation) throws Throwable;  
}
```
- `MethodInvocation invocation` 다음 메서드를 호출하는 방법, 현재 프록시 객체 인스턴스, `args` 정보를 포함 (기존의 파라메터로 제공되는 부분들을 모두 안으로 들임)
## 단점
- 너무 많은 설정
- 컴포넌트 스캔
## 예제
```java title:"Advice 예제" hl:6
@Slf4j
public class TimeAdvice implements MethodInterceptor {
  @Override
  public Object invoke(MethodInvocation invocation) throws Throwable {
    long start = System.currentTimeMillis();
    Object result = invocation.proceed();
    long end = System.currentTimeMillis();
    log.info("소요 시간: {}", end - start);
    return result;
  }
}
```

```java title:"lambda 사용하지 않은 것과 사용하여 만든 것"
public interface AInterface {  
  public String call();  
}

public class AImpl implements AInterface {  
  @Override  
  public String call() {  
    return "AImpl.call()";  
  }  
}

@Test  
@DisplayName("인터페이스가 없으면 CGLIB를 사용")
void testObj() {  
  AInterface a = new AImpl();  
  ProxyFactory proxyFactory = new ProxyFactory(a);  
  proxyFactory.addAdvice(new TimeAdvice());  
  AInterface proxy = (AInterface) proxyFactory.getProxy();  
  proxy.call();  
}

// MethodInterceptor 직접 정의하지 않은 방법
@Test  
@DisplayName("lambda로 구현한 MethodInterceptor를 사용")  
void testObj2() {  
  AInterface a = new AImpl();  
  ProxyFactory proxyFactory = new ProxyFactory(a);  
  proxyFactory.addAdvice((MethodInterceptor) invocation -> {  
    log.info("before");  
    Object result = invocation.proceed();  
    log.info("after");  
    return result;  
  });  
  AInterface proxy = (AInterface) proxyFactory.getProxy();  
  proxy.call();  
}
```

```java title:"무조건 CGLIB 사용하는 방법"
@Test  
@DisplayName("ProxyTargetClass를 true로 설정하면 CGLIB를 사용")  
void proxyFactory2() {  
  AImpl a = new AImpl();  
  ProxyFactory proxyFactory = new ProxyFactory(a);  
  proxyFactory.setProxyTargetClass(true);  
  proxyFactory.addAdvice(new TimeAdvice());  
  AImpl proxy = (AImpl) proxyFactory.getProxy();  
  
  log.info("proxy: {}", proxy.getClass());  
  log.info("proxy super: {}", proxy.getClass().getSuperclass());  
  proxy.save();  
  
  Assertions.assertTrue(AopUtils.isCglibProxy(proxy));  
}
```

## `Proxy = (Advisor = Pointcut + Advice)[]`
- 포인트컷(`pointcut`) : 어디에 부가 기능을 적용할지, 어디에 부가 기능을 적용하지 않을지 판단하는 필터링 로직(주로 클래스와 메서드 이름으로 필터링)
	- 프록시 적용 대상 여부를 체크해서 꼭 필요한 곳에만 프록시 적용([[#BeanPostProcessor(빈 후처리기)]] 자동 생성)
	- 프록시의 어떤 메서드가 호출 되었을 때 어드바이스를 적용할지 판단
- 어드바이스(`Advice`) : 프록시가 호출하는 부가 기능(프록시 로직)
- 어드바이저(`Advisor`) : 하나의 포인트컷과 하나의 어드바이스를 가지고 있는 것
```plantuml
@startuml
title Spring AOP - Advisor, Pointcut, Advice, Proxy

class Advisor {
  +Pointcut
  +Advice
}

class Pointcut {
}

class Advice {
}

class Proxy {
  +Advisor[]
}

Advisor --> Pointcut : has a
Advisor --> Advice : has a
Proxy --> Advisor : contains multiple
@enduml
```


```java title:"pointcut"
package org.springframework.aop;  
  
public interface Pointcut {  
  Pointcut TRUE = TruePointcut.INSTANCE;  
  
  ClassFilter getClassFilter();  
  
  MethodMatcher getMethodMatcher();  
}
```

```java title:"MethodMatcher"
public interface MethodMatcher {  
  MethodMatcher TRUE = TrueMethodMatcher.INSTANCE;  
  
  boolean matches(Method method, Class<?> targetClass);  
  // isRuntime true 일 경우 아래 함수가 호출, false 일 경우 위에 함수가 호출 (args 때문에 성능 이슈로 나눔)
  boolean isRuntime();  
  
  boolean matches(Method method, Class<?> targetClass, Object... args);  
}
```


 > [!hint] `advisor` 는 하나의 `Proxy`에  여러개를 등록 가능
```java title:"여러 advisor 등록하는 방법"
@Slf4j  
public class MultiAdvisorTest {  
  @Slf4j  
  static class Advice1 implements MethodInterceptor {  
    @Override  
    public Object invoke(MethodInvocation invocation) throws Throwable {  
      log.info("Advice1.invoke() Start");  
      Object result = invocation.proceed();  
      log.info("Advice1.invoke() End");  
      return result;  
    }  
  }  
  
  @Slf4j  
  static class Advice2 implements MethodInterceptor {  
    @Override  
    public Object invoke(MethodInvocation invocation) throws Throwable {  
      log.info("Advice2.invoke() Start");  
      Object result = invocation.proceed();  
      log.info("Advice2.invoke() End");  
      return result;  
    }  
  }  
  
  @Test  
  @DisplayName("여러 Advisor 사용")  
  void multiAdvisor() {  
    AInterface a = new AImpl();  
    ProxyFactory proxyFactory = new ProxyFactory(a);  
    DefaultPointcutAdvisor advisor1 = new DefaultPointcutAdvisor(Pointcut.TRUE, new Advice1());  
    DefaultPointcutAdvisor advisor2 = new DefaultPointcutAdvisor(Pointcut.TRUE, new Advice2());  
    proxyFactory.addAdvisor(advisor1);  
    proxyFactory.addAdvisor(advisor2);  
    AInterface proxy = (AInterface) proxyFactory.getProxy();  
    proxy.call();  
  }  
}
```
결과는 넣은 순서대로 표기
```log title:"여러 어드바이저 등록 시 실행되는 순서는 넣은 순서대로"
10:03:56.378 [Test worker] INFO hello.proxy.advisor.MultiAdvisorTest$Advice1 - Advice1.invoke() Start
10:03:56.379 [Test worker] INFO hello.proxy.advisor.MultiAdvisorTest$Advice2 - Advice2.invoke() Start
10:03:56.379 [Test worker] INFO hello.proxy.common.testobj.AImpl - AImpl.call()
10:03:56.380 [Test worker] INFO hello.proxy.advisor.MultiAdvisorTest$Advice2 - Advice2.invoke() End
10:03:56.380 [Test worker] INFO hello.proxy.advisor.MultiAdvisorTest$Advice1 - Advice1.invoke() End
```

### 직접 만들어서 써보는 pointcut
```java title:"직접 만들어보는 pointcut"
public interface AInterface {  
  public String call();  
  public String func();  
}

@Slf4j  
public class AImpl implements AInterface {  
  @Override  
  public String call() {  
    log.info("AImpl.call()");  
    return "AImpl.call()";  
  }  
  
  @Override  
  public String func() {  
    log.info("AImpl.func()");  
    return "AImpl.func()";  
  }  
}

class MyMethodMatcher implements MethodMatcher {  
  @Override  
  public boolean matches(Method method, Class<?> targetClass) {  
    boolean result = method.getName().equals("call");  
    log.info("MethodMatcher.matches() method: {} targetClass: {} result: {}", method.getName(), targetClass, result);  
    return result;  
  }  
  
  @Override  
  public boolean isRuntime() {  
    return false;  
  }  
  
  @Override  
  public boolean matches(Method method, Class<?> targetClass, Object[] args) {  
    return false;  
  }  
}  
class MyPointcut implements Pointcut {  
  @Override  
  public ClassFilter getClassFilter() {  
    return ClassFilter.TRUE;  
  }  
  
  @Override  
  public MethodMatcher getMethodMatcher() {  
    return new MyMethodMatcher();  
  }  
}  
  
@Test  
@DisplayName("직접 만든 Pointcut을 사용")  
void advisorTest2() {  
  AInterface a = new AImpl();  
  ProxyFactory proxyFactory = new ProxyFactory(a);  
  DefaultPointcutAdvisor advisor = new DefaultPointcutAdvisor(new MyPointcut(), new TimeAdvice());  
  proxyFactory.addAdvisor(advisor);  
  AInterface proxy = (AInterface) proxyFactory.getProxy();  
  proxy.call();  
  proxy.func();  
}
```

### Spring 제공하는 pointcut
- `NameMatchMethodPointcut` : 메서드 이름 기반으로 매칭. 내부에서 [[2.Ref(데이터 및 정보 저장)/Spring/공통관심사/PatternMatchUtils|PatternMatchUtils]] 사용
- `JdkRegexpMethodPointcut` : JDK 정규 표현식을 기반으로 포인트컷을 생성
- `TruePointcut` : 항상 동작하는 포인트컷
- `AnnotationMatchingPointcut` : 어노테이션으로 매칭
- `AspectJExpressionPointcut` : aspectJ 표현식으로 매칭 (가장 많이 사용)



```java title:"스프링이 제공하는 pointcut 사용"
@Test  
@DisplayName("스프링이 제공하는 Pointcut을 사용")  
void advisorTest3() {  
  AInterface a = new AImpl();  
  ProxyFactory proxyFactory = new ProxyFactory(a);  
  NameMatchMethodPointcut pointcut = new NameMatchMethodPointcut();  
  pointcut.addMethodName("call");  
  DefaultPointcutAdvisor advisor = new DefaultPointcutAdvisor(pointcut, new TimeAdvice());  
  proxyFactory.addAdvisor(advisor);  
  AInterface proxy = (AInterface) proxyFactory.getProxy();  
  proxy.call();  
  proxy.func();  
}
```

# BeanPostProcessor(빈 후처리기)
후킹같은 기능
빈 등록 전에 먼저 BeanPostProcessor(빈 후처리기) 로 전달되어 변경할 것이 있는지 확인 후 [[IOC 컨테이너]]로 이동
보통 후처리기의 적용 조건은 `pointcut`을 이용해서 적용할지 말지 선택
```java title:"BeanPostProcessor"
public interface BeanPostProcessor {
  @Nullable
  default Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
    return bean;
  }

  @Nullable
  default Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
    return bean;
  }
}
```
- `postProcessBeforeInitialization()` : 객체 생성 이후에 [[2.Ref(데이터 및 정보 저장)/Spring/Annotation/@PostConstruct|@PostConstruct]] 같은 초기화가 발생하기 전에 호출되는 포스트 프로세서
- `postProcessAfterInitialization()` : 객체 생성 이후에 [[2.Ref(데이터 및 정보 저장)/Spring/Annotation/@PostConstruct|@PostConstruct]] 같은 초기화 발생한 다음에 호출되는 포스트 프로세서

```java title:"특정 packageName 이 포함된 Bean 들만 Proxy 설정"
@Slf4j
public class PackageLogTracePostProcessor implements BeanPostProcessor {
  // 특정 패키지 하위의 빈들만 적용
  private final String basePackage;
  private final Advisor advisor;

  public PackageLogTracePostProcessor(String basePackage, Advisor advisor) {
    this.basePackage = basePackage;
    this.advisor = advisor;
  }

  @Override
  public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
    log.info("PackageLogTracePostProcessor.postProcessAfterInitialization() Start");
    log.info("bean: {} / beanName: {}", bean.getClass(), beanName);

    // 프록시 대상여부 체크
    String packageName = bean.getClass().getPackageName();

    if (!packageName.startsWith(basePackage)) {
      return bean;
    }
    
    // 프록시 생성
    ProxyFactory proxyFactory = new ProxyFactory(bean);
    proxyFactory.addAdvisor(advisor);
    Object proxy = proxyFactory.getProxy();

    log.info("target: {} / proxy: {}", bean.getClass(), proxy.getClass());
    log.info("PackageLogTracePostProcessor.postProcessAfterInitialization() End");
    return proxy;
  }
}
```

# 스프링이 제공하는 빈 후처리기
==여기서부터는 사실 [[2.Ref(데이터 및 정보 저장)/Spring/공통관심사/AOP|AOP]]  아니냐?==

`{gradle title:"필수 필요" icon}implementation 'org.springframework.boot:spring-boot-starter-aop'`
스프링 부트가 없던 시절에는 `@EnableAspectJAutoProxy` 를 직접 사용해야 적용이 되었는데 이제는 스프링 부트가 알아서 사용
해당 설정을 하는 경우 `AutoProxyCreator` 이라는 자동 프록시 생성기를 등록
`AnnotationAwareAspectJAutoProxyCreator` 라는 빈 후처리기가 스프링 빈에 자동 등록

`AnnotationAwareAspectJAutoProxyCreator` : 스프링 빈으로 등록된 `Advisor`들을 자동으로 찾아서 프록시가 필요한 곳에 자동으로 프록시를 적용


과정
스프링이 @Bean -> 자동 프록시 생성기
자동 프록시 생성기 -> 스프링 컨테이너에 Advisor 모두 조회
Advisor 들을 등록하려는 @Bean 에 적용 가능한지 포인트컷 확인

```plantuml
@startuml
title Spring AOP - AnnotationAwareAspectJAutoProxyCreator 진행 과정

skinparam participant {
    BackgroundColor LightBlue
    BorderColor DarkGray
}

autonumber "<b>[#번#]</b>"

participant "서버 프로세스" as a #Yellow
participant "자동 프록시 생성기" as b #LightGreen
participant "스프링 컨테이너" as c #LightPink
participant "BeanFactoryAspectJAdivisorsBuilder" as d #LightBlue

b -> c : <color blue>@Aspect 어노테이션 등록된 빈 조회</color>
b -> d : <color blue>@Aspect 어노테이션이 있는 빈들 모두 전달</color>
d -> d : <color blue>@Aspect 내부 정보를 이용해 Advisor 생성하여 내부 캐시</color>

a -> b : <color red>@Bean 객체 전달</color>
b -> c : <color green>Advisor Bean 모두 가져오기</color>
b -> d : <color green>@Aspect Advisor 모두 가져오기</color>
b -> b : <color red>@Bean 객체가 Advisor의 Pointcut 조건에 맞는 모든 Advisor 적용하여 Proxy 객체 생성</color>
b -> c : <color red>@Bean 객체 또는 적용된 Proxy 객체 등록</color>
@enduml
```
- `BeanFactoryAspectJAdivisorsBuilder` : `@Aspect` 정보를 기반으로 `pointcut`, `Advice`, `Advisor` 생성하고 보관
  `@Aspect` 정보를 기반으로 어드바이저를 만들고 Aspect 빌더 내부 저장소에 캐시
  캐시에 어드바이저가 만들어져 있는 경우 저장된 어드바이저 반환

## AOP 에서 거진 이것만 쓰는 pointcut `AspectJExpressionPointcut`
```java title:"AspectJExpressionPointcut 사용 예시"
@Bean  
public Advisor advisor2(LogTrace logTrace) {  
  AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();  
  pointcut.setExpression("execution(* hello.proxy.app..*(..))");  
  return new DefaultPointcutAdvisor(pointcut, new LogTraceAdvice(logTrace));  
}
```

- `*` : 모든 반환 타입
- `hello.proxy.app..` : 해당 패키지와 그 하위 패키지
- `*(..)` : `*` 모든 메서드 이름, `(..)` 파라메터 상관 없음

```java title:"noLog 라는 함수만 적용 안하는 방법"
@Bean  
public Advisor advisor3(LogTrace logTrace) {  
  AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();  
  pointcut.setExpression("execution(* hello.proxy.app..*(..)) && !exclude(* hello.proxy.app..noLog*(..))");  
  return new DefaultPointcutAdvisor(pointcut, new LogTraceAdvice(logTrace));  
}
```


# AOP
[[2.Ref(데이터 및 정보 저장)/Spring/공통관심사/AOP|AOP]]
[[2.Ref(데이터 및 정보 저장)/Spring/공통관심사/AspectJ|AspectJ]] 
[[2.Ref(데이터 및 정보 저장)/Spring/Annotation/@Aspect|@Aspect]]
AOP 내용은 너무 많아서 분할
애초에 자주 사용되는 내용은 AOP

[[2.Ref(데이터 및 정보 저장)/Spring/공통관심사/AOP|AOP]]




5:["$","div",null,{"className":"page_container__MI3fw","children":["$","$L13",null,{"post":{"slug":"Spring/공통관심사/Proxy","slugHash":"f499cc48","content":"$14","markdownContent":"$15","title":"Proxy","createdAt":"2025-09-11","updatedAt":"2025-09-11","tags":["Java","Spring"],"isPublished":true,"excerpt":"$undefined","coverImgUrl":"$undefined","aliases":["Proxy","Dynamic Proxy","CGLIB","프록시","Interface Proxy","Class Proxy","ProxyFactory","BeanPostProcessor"],"noteUUID":"$undefined"}}]}]
e:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
9:null
12:{"metadata":[["$","title","0",{"children":"서동민 개발 블로그"}],["$","meta","1",{"name":"description","content":"서동민 개발 블로그"}],["$","meta","2",{"property":"og:title","content":"서동민 개발 블로그"}],["$","meta","3",{"property":"og:description","content":"서동민 개발 블로그"}],["$","meta","4",{"name":"twitter:card","content":"summary"}],["$","meta","5",{"name":"twitter:title","content":"서동민 개발 블로그"}],["$","meta","6",{"name":"twitter:description","content":"서동민 개발 블로그"}],["$","link","7",{"rel":"icon","href":"/github-blog/favicon.ico","type":"image/x-icon","sizes":"16x16"}]],"error":null,"digest":"$undefined"}
c:{"metadata":"$12:metadata","error":null,"digest":"$undefined"}
