1:"$Sreact.fragment"
2:I[7913,["874","static/chunks/874-b079fddb84576c63.js","177","static/chunks/app/layout-c31b52eaf0841be1.js"],"default"]
3:I[7555,[],""]
4:I[1295,[],""]
6:I[9665,[],"MetadataBoundary"]
8:I[9665,[],"OutletBoundary"]
b:I[4911,[],"AsyncMetadataOutlet"]
d:I[9665,[],"ViewportBoundary"]
f:I[6614,[],""]
:HL["/github-blog/_next/static/css/a8e036e7bd01ae38.css","style"]
:HL["/github-blog/_next/static/css/0d98168a1605ff50.css","style"]
0:{"P":null,"b":"sdcnNz3Ip_h_54vF_ahXN","p":"/github-blog","c":["","blog","5766993c",""],"i":false,"f":[[["",{"children":["blog",{"children":[["slugHash","5766993c","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/github-blog/_next/static/css/a8e036e7bd01ae38.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"kr","children":["$","body",null,{"children":[["$","$L2",null,{}],["$","main",null,{"children":["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slugHash","5766993c","d"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L5",["$","$L6",null,{"children":"$L7"}],[["$","link","0",{"rel":"stylesheet","href":"/github-blog/_next/static/css/0d98168a1605ff50.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L8",null,{"children":["$L9","$La",["$","$Lb",null,{"promise":"$@c"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","uVTXBeKoelfRYulu309Ws",{"children":[["$","$Ld",null,{"children":"$Le"}],null]}],null]}],false]],"m":"$undefined","G":["$f","$undefined"],"s":false,"S":true}
10:"$Sreact.suspense"
11:I[4911,[],"AsyncMetadata"]
7:["$","$10",null,{"fallback":null,"children":["$","$L11",null,{"promise":"$@12"}]}]
a:null
13:I[6704,["63","static/chunks/63-26bac0ebf4c81355.js","727","static/chunks/727-27da60f8cc92f67b.js","401","static/chunks/app/blog/%5BslugHash%5D/page-5aeacacd471d8dc2.js"],"default"]
14:T4fb4,<h1 style="color: #82AAFF;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h1</span>
                  CSRF(CROSS-SITE REQUEST FORGERY)
                </h1>
<p>CSRF 공격을 방어하기 위한 방법<br><br>하지만 API 서버일 경우 세션을 <br>CSRF를 완전히 비활성화 하는것은 추천하지 않는 방법  을 사용해도 무관함<br> 와 세션은 없기 떄문에 상관 없음<br>는 세션을 관리할 경우 발생하는 문제라고 생각해도 될 것 같은데<br> 의 공격 방법은 다른 사이트에서 나의 사이트에 요청을 만들어서 전달할때 쿠키가 자동으로 딸려 날아가면서 발생하는 문제<br>라고는 하는데 사실 쿠키를 같이 전달하는게 문제라면 <code>STATELESS</code>로 관리하기 때문에 <code>csrf().disable()</code> 을 사용해도 무관함
어차피 <code>JWT</code> 와 세션은 없기 떄문에 상관 없음
그렇다면 <code>CSRF</code>는 세션을 관리할 경우 발생하는 문제라고 생각해도 될 것 같은데
<code>CSRF</code> 의 공격 방법은 다른 사이트에서 나의 사이트에 요청을 만들어서 전달할때 쿠키가 자동으로 딸려 날아가면서 발생하는 문제
라고는 하는데 사실 쿠키를 같이 전달하는게 문제라면 <code>JWT</code> 관리 방식도 자동으로 전달되기 때문에 문제 아닌가?</p>

<div class="callout" style="--callout-color: 0, 184, 148;">
  <div class="callout-title">
    <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l.293.293a1 1 0 001.414-1.414l-3-3z" clip-rule="evenodd" /></svg></div>
    <div class="callout-title-text">난 </div>
  </div>
  <div class="callout-content">
    <p><code>permitAll()</code> 을 줬는데 !!!
<code>permitAll()</code> 도 줬는데 <code>401(Unauthorized)</code> 에러나 <code>403(Forbidden)</code> 에러가 발생하는 경우가 있는데
이럴땐 CSRF 설정을 해주었는지 확인해야함</p>

  </div>
</div>
<p>보호할 필요 없는 공공으로 사용되는 API의 경우의 설정</p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line">http.csrf(csrf -&gt; csrf.ignoringRequestMatchers(<span class="hljs-string">&quot;/register&quot;</span>));</span></code></pre>
        </div>
      
<p>사용할때의 예제</p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line"><span class="hljs-type">CsrfTokenRequestAttributeHandler</span> <span class="hljs-variable">csrfTokenRequestAttributeHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CsrfTokenRequestAttributeHandler</span>();  </span><span class="line">csrfTokenRequestAttributeHandler.setCsrfRequestAttributeName(<span class="hljs-string">&quot;_csrf&quot;</span>);  </span><span class="line">  </span><span class="line">http.securityContext(securityContext -&gt; securityContext.requireExplicitSave(<span class="hljs-literal">false</span>));  </span><span class="line">http.sessionManagement(sessionManagement -&gt; sessionManagement.sessionCreationPolicy(SessionCreationPolicy.ALWAYS));  </span><span class="line">http.csrf(  </span><span class="line">  csrf -&gt; csrf.ignoringRequestMatchers(<span class="hljs-string">&quot;/register&quot;</span>)  </span><span class="line">    .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())  </span><span class="line">    .csrfTokenRequestHandler(csrfTokenRequestAttributeHandler)  </span><span class="line">);  </span><span class="line">http.addFilterAfter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CsrfCookieFilter</span>(), BasicAuthenticationFilter.class);</span></code></pre>
        </div>
      
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  CsrfTokenRequestAttributeHandler
                </h2>
<p><code>CSRF</code> 토큰을 <a href="/github-blog/blog/0e7c35fd">HttpServletRequest</a>.setAttribute() 로 등록시키는 역활</p>
<h2 style="color: #C3E88D;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h2</span>
                  CookieCsrfTokenRepository
                </h2>
<p><code>Cookie</code>로 <code>CSRF</code> 토큰을 전달하고 <code>Header</code>로 <code>CSRF</code> 토큰을 받아서 검증하는 방법</p>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>Java</title><path d="M 28.1875 0 C 30.9375 6.363281 18.328125 10.292969 17.15625 15.59375 C 16.082031 20.464844 24.648438 26.125 24.65625 26.125 C 23.355469 24.109375 22.398438 22.449219 21.09375 19.3125 C 18.886719 14.007813 34.535156 9.207031 28.1875 0 Z M 36.5625 8.8125 C 36.5625 8.8125 25.5 9.523438 24.9375 16.59375 C 24.6875 19.742188 27.847656 21.398438 27.9375 23.6875 C 28.011719 25.558594 26.0625 27.125 26.0625 27.125 C 26.0625 27.125 29.609375 26.449219 30.71875 23.59375 C 31.949219 20.425781 28.320313 18.285156 28.6875 15.75 C 29.039063 13.324219 36.5625 8.8125 36.5625 8.8125 Z M 19.1875 25.15625 C 19.1875 25.15625 9.0625 25.011719 9.0625 27.875 C 9.0625 30.867188 22.316406 31.089844 31.78125 29.25 C 31.78125 29.25 34.296875 27.519531 34.96875 26.875 C 28.765625 28.140625 14.625 28.28125 14.625 27.1875 C 14.625 26.179688 19.1875 25.15625 19.1875 25.15625 Z M 38.65625 25.15625 C 37.664063 25.234375 36.59375 25.617188 35.625 26.3125 C 37.90625 25.820313 39.84375 27.234375 39.84375 28.84375 C 39.84375 32.46875 34.59375 35.875 34.59375 35.875 C 34.59375 35.875 42.71875 34.953125 42.71875 29 C 42.71875 26.296875 40.839844 24.984375 38.65625 25.15625 Z M 16.75 30.71875 C 15.195313 30.71875 12.875 31.9375 12.875 33.09375 C 12.875 35.417969 24.5625 37.207031 33.21875 33.8125 L 30.21875 31.96875 C 24.351563 33.847656 13.546875 33.234375 16.75 30.71875 Z M 18.1875 35.9375 C 16.058594 35.9375 14.65625 37.222656 14.65625 38.1875 C 14.65625 41.171875 27.371094 41.472656 32.40625 38.4375 L 29.21875 36.40625 C 25.457031 37.996094 16.015625 38.238281 18.1875 35.9375 Z M 11.09375 38.625 C 7.625 38.554688 5.375 40.113281 5.375 41.40625 C 5.375 48.28125 40.875 47.964844 40.875 40.9375 C 40.875 39.769531 39.527344 39.203125 39.03125 38.9375 C 41.933594 45.65625 9.96875 45.121094 9.96875 41.15625 C 9.96875 40.253906 12.320313 39.390625 14.5 39.8125 L 12.65625 38.75 C 12.113281 38.667969 11.589844 38.636719 11.09375 38.625 Z M 44.625 43.25 C 39.226563 48.367188 25.546875 50.222656 11.78125 47.0625 C 25.542969 52.695313 44.558594 49.535156 44.625 43.25 Z"/></svg></span>
              <span class="custom-code-block-lang-text">java</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-java hljs"><span class="line">http.csrf(  </span><span class="line">  csrf -&gt; csrf.ignoringRequestMatchers(<span class="hljs-string">&quot;/register&quot;</span>)  </span><span class="line">    .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())  </span><span class="line">    .csrfTokenRequestHandler(csrfTokenRequestAttributeHandler)  </span><span class="line">).addFilterAfter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CsrfCookieFilter</span>(), BasicAuthenticationFilter.class);</span></code></pre>
        </div>
      
<p>withHttpOnlyFalse 함수는 javascript 로도 처리가 가능하도록 하는 설정<br>React 등의 라이브러리를 사용할 경우 필수</p>
<h3 style="color: #C792EA;">
                  <span style="font-size: initial; color: #F0C292; margin-right: 0.5em;">h3</span>
                  프론트 처리 방법
                </h3>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>TypeScript</title><path d="M 5 4 A 1.0001 1.0001 0 0 0 4 5 L 4 45 A 1.0001 1.0001 0 0 0 5 46 L 45 46 A 1.0001 1.0001 0 0 0 46 45 L 46 5 A 1.0001 1.0001 0 0 0 45 4 L 5 4 z M 6 6 L 44 6 L 44 44 L 6 44 L 6 6 z M 15 23 L 15 26.445312 L 20 26.445312 L 20 42 L 24 42 L 24 26.445312 L 29 26.445312 L 29 23 L 15 23 z M 36.691406 23.009766 C 33.576782 22.997369 30.017578 23.941219 30.017578 28.324219 C 30.017578 34.054219 37.738281 34.055625 37.738281 36.640625 C 37.738281 36.885625 37.842187 38.666016 35.117188 38.666016 C 32.392187 38.666016 30.121094 36.953125 30.121094 36.953125 L 30.121094 41.111328 C 30.121094 41.111328 42.001953 44.954062 42.001953 36.289062 C 42.000953 30.664063 34.208984 30.945391 34.208984 28.150391 C 34.208984 27.067391 34.978375 26.054687 37.109375 26.054688 C 39.240375 26.054688 41.126953 27.3125 41.126953 27.3125 L 41.267578 23.607422 C 41.267578 23.607422 39.113892 23.019408 36.691406 23.009766 z"/></svg></span>
              <span class="custom-code-block-lang-text">typescript</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-typescript hljs"><span class="line"><span class="hljs-keyword">let</span> xsrf = <span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&#x27;XSRF-TOKEN&#x27;</span>)!;</span><span class="line"><span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;XSRF-TOKEN&quot;</span>, xsrf);</span></code></pre>
        </div>
      
<blockquote>
<p>서버에서 받은 XSRF 토큰을 저장</p>
</blockquote>

        <div class="custom-code-block">
          
        <div class="custom-code-block-header">
          <div class="custom-code-block-header-left">
            <div class="custom-code-block-lang">
              <span class="custom-code-block-icon"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="50px" height="50px"><title>TypeScript</title><path d="M 5 4 A 1.0001 1.0001 0 0 0 4 5 L 4 45 A 1.0001 1.0001 0 0 0 5 46 L 45 46 A 1.0001 1.0001 0 0 0 46 45 L 46 5 A 1.0001 1.0001 0 0 0 45 4 L 5 4 z M 6 6 L 44 6 L 44 44 L 6 44 L 6 6 z M 15 23 L 15 26.445312 L 20 26.445312 L 20 42 L 24 42 L 24 26.445312 L 29 26.445312 L 29 23 L 15 23 z M 36.691406 23.009766 C 33.576782 22.997369 30.017578 23.941219 30.017578 28.324219 C 30.017578 34.054219 37.738281 34.055625 37.738281 36.640625 C 37.738281 36.885625 37.842187 38.666016 35.117188 38.666016 C 32.392187 38.666016 30.121094 36.953125 30.121094 36.953125 L 30.121094 41.111328 C 30.121094 41.111328 42.001953 44.954062 42.001953 36.289062 C 42.000953 30.664063 34.208984 30.945391 34.208984 28.150391 C 34.208984 27.067391 34.978375 26.054687 37.109375 26.054688 C 39.240375 26.054688 41.126953 27.3125 41.126953 27.3125 L 41.267578 23.607422 C 41.267578 23.607422 39.113892 23.019408 36.691406 23.009766 z"/></svg></span>
              <span class="custom-code-block-lang-text">typescript</span>
            </div>
            
          </div>
          <div class="custom-code-block-header-right">
            <div class="custom-code-block-actions">
              <button class="copy-code-button" title="Copy code">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
            </div>
          </div>
        </div>
      
          <pre><code class="language-typescript hljs"><span class="line"><span class="hljs-keyword">let</span> xsrf = <span class="hljs-variable language_">sessionStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;XSRF-TOKEN&#x27;</span>);</span><span class="line"><span class="hljs-keyword">if</span>( xsrf ) {</span><span class="line">	httpHeaders = <span class="hljs-title class_">HttpHeaders</span>.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;X-XSRF-TOKEN&#x27;</span>, xsrf);</span><span class="line">}</span></code></pre>
        </div>
      
<blockquote>
<p>서버에서 받은 XSRF 토큰을 다시 헤더에 담아서 전달</p>
</blockquote>
15:Tcff,---
aliases:
  - CSRF
tags:
  - Spring
  - Spring/Security
특징: 쿠키에 값 꽂아주면 헤더로 전달 못하면 차단박아 버리는 방법
---
# CSRF(CROSS-SITE REQUEST FORGERY)
CSRF 공격을 방어하기 위한 방법
Spring Security는 GET 요청을 제외한 모든 요청인 데이터베이스나 백엔드 내부의 데이터를 수정하고자 하는것을 막도록 되어 있음
CSRF를 완전히 비활성화 하는것은 추천하지 않는 방법 `csrf().disable()`
하지만 API 서버일 경우 세션을 `STATELESS`로 관리하기 때문에 `csrf().disable()` 을 사용해도 무관함
어차피 `JWT` 와 세션은 없기 떄문에 상관 없음
그렇다면 `CSRF`는 세션을 관리할 경우 발생하는 문제라고 생각해도 될 것 같은데
`CSRF` 의 공격 방법은 다른 사이트에서 나의 사이트에 요청을 만들어서 전달할때 쿠키가 자동으로 딸려 날아가면서 발생하는 문제
라고는 하는데 사실 쿠키를 같이 전달하는게 문제라면 `JWT` 관리 방식도 자동으로 전달되기 때문에 문제 아닌가?

> [!hint] 난 `permitAll()` 을 줬는데 !!!
`permitAll()` 도 줬는데 `401(Unauthorized)` 에러나 `403(Forbidden)` 에러가 발생하는 경우가 있는데
이럴땐 CSRF 설정을 해주었는지 확인해야함

보호할 필요 없는 공공으로 사용되는 API의 경우의 설정
```java
http.csrf(csrf -> csrf.ignoringRequestMatchers("/register"));
```

사용할때의 예제
```java
CsrfTokenRequestAttributeHandler csrfTokenRequestAttributeHandler = new CsrfTokenRequestAttributeHandler();  
csrfTokenRequestAttributeHandler.setCsrfRequestAttributeName("_csrf");  
  
http.securityContext(securityContext -> securityContext.requireExplicitSave(false));  
http.sessionManagement(sessionManagement -> sessionManagement.sessionCreationPolicy(SessionCreationPolicy.ALWAYS));  
http.csrf(  
  csrf -> csrf.ignoringRequestMatchers("/register")  
    .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())  
    .csrfTokenRequestHandler(csrfTokenRequestAttributeHandler)  
);  
http.addFilterAfter(new CsrfCookieFilter(), BasicAuthenticationFilter.class);
```
## CsrfTokenRequestAttributeHandler
`CSRF` 토큰을 [[2.Ref(데이터 및 정보 저장)/Spring/HttpServletRequest|HttpServletRequest]].setAttribute() 로 등록시키는 역활
## CookieCsrfTokenRepository
`Cookie`로 `CSRF` 토큰을 전달하고 `Header`로 `CSRF` 토큰을 받아서 검증하는 방법
```java
http.csrf(  
  csrf -> csrf.ignoringRequestMatchers("/register")  
    .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())  
    .csrfTokenRequestHandler(csrfTokenRequestAttributeHandler)  
).addFilterAfter(new CsrfCookieFilter(), BasicAuthenticationFilter.class);
```
withHttpOnlyFalse 함수는 javascript 로도 처리가 가능하도록 하는 설정
React 등의 라이브러리를 사용할 경우 필수
### 프론트 처리 방법
```typescript
let xsrf = getCookie('XSRF-TOKEN')!;
window.sessionStorage.setItem("XSRF-TOKEN", xsrf);
```
> 서버에서 받은 XSRF 토큰을 저장

```typescript
let xsrf = sessionStorage.getItem('XSRF-TOKEN');
if( xsrf ) {
	httpHeaders = HttpHeaders.append('X-XSRF-TOKEN', xsrf);
}
```
> 서버에서 받은 XSRF 토큰을 다시 헤더에 담아서 전달

5:["$","div",null,{"className":"page_container__MI3fw","children":["$","$L13",null,{"post":{"slug":"Spring/Security/CSRF","slugHash":"5766993c","content":"$14","markdownContent":"$15","title":"CSRF","createdAt":"2025-09-16","updatedAt":"2025-09-16","tags":["Spring","Spring/Security"],"isPublished":false,"excerpt":"$undefined","coverImgUrl":"$undefined","aliases":["CSRF"],"noteUUID":"$undefined"}}]}]
e:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
9:null
12:{"metadata":[["$","title","0",{"children":"서동민 개발 블로그"}],["$","meta","1",{"name":"description","content":"서동민 개발 블로그"}],["$","meta","2",{"property":"og:title","content":"서동민 개발 블로그"}],["$","meta","3",{"property":"og:description","content":"서동민 개발 블로그"}],["$","meta","4",{"name":"twitter:card","content":"summary"}],["$","meta","5",{"name":"twitter:title","content":"서동민 개발 블로그"}],["$","meta","6",{"name":"twitter:description","content":"서동민 개발 블로그"}],["$","link","7",{"rel":"icon","href":"/github-blog/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","link","8",{"rel":"icon","href":"/github-blog/icon.png?0057d00b6eb4edf8","type":"image/png","sizes":"1024x1024"}],["$","link","9",{"rel":"apple-touch-icon","href":"/github-blog/apple-icon.png?2209b5b7eb9606d8","type":"image/png","sizes":"180x180"}]],"error":null,"digest":"$undefined"}
c:{"metadata":"$12:metadata","error":null,"digest":"$undefined"}
